<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Participação Os Mais Mais</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'siren': 'siren 1s infinite',
                    },
                    keyframes: {
                        'pop': { '0%': { transform: 'scale(0.9)', opacity: 0 }, '100%': { transform: 'scale(1)', opacity: 1 } },
                        'siren': { '0%, 100%': { boxShadow: '0 0 20px rgba(220, 38, 38, 0.5)' }, '50%': { boxShadow: '0 0 40px rgba(220, 38, 38, 0.9)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background: #0b141a; color: #e9edef; font-family: 'Outfit', sans-serif; min-height: 100vh; overflow-x: hidden; }
        .glass-card { background: rgba(32, 44, 51, 0.95); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .solid-input { background: #2a3942; border: 1px solid #2a3942; color: #d1d7db; border-radius: 20px; padding: 12px 16px; width: 100%; outline: none; font-weight: 500; transition: 0.3s; }
        .solid-input:focus { border-color: #00a884; background: #2a3942; }
        .btn-action { background: #00a884; color: #111b21; padding: 14px; border-radius: 24px; font-weight: 800; width: 100%; transition: 0.2s; cursor: pointer; text-transform: uppercase; }
        .btn-action:active { transform: scale(0.95); opacity: 0.9; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .chat-bubble { max-width: 80%; padding: 8px 12px; margin-bottom: 4px; font-size: 0.95rem; word-wrap: break-word; position: relative; line-height: 1.4; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13); }
        .chat-me { background-color: #005c4b; color: #e9edef; align-self: flex-end; border-radius: 8px 0px 8px 8px; }
        .chat-partner { background-color: #202c33; color: #e9edef; align-self: flex-start; border-radius: 0px 8px 8px 8px; }
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 400px; pointer-events: none; }
        .toast-item { background: #202c33; color: white; padding: 12px 16px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 12px; pointer-events: auto; animation: pop 0.4s ease; border-left: 4px solid #00a884; }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen w-full flex items-center justify-center p-2 pb-24 md:pb-4 bg-[#111b21]"></div>
    <div id="toast-container"></div>
    <div class="fixed bottom-1 right-2 text-[10px] text-gray-600 font-mono opacity-50 pointer-events-none z-50">v56.0 (Ultimate Fix)</div>

    <!-- MODAIS E COMPONENTES -->
    <div id="adminInputModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-md p-4">
        <div class="glass-card p-6 w-full max-w-md bg-[#202c33]">
            <h2 class="text-xl font-bold mb-4 text-[#e9edef]">Escrever Mensagem</h2>
            <textarea id="adminInputText" class="solid-input h-32 mb-4" placeholder="Escreva aqui..."></textarea>
            <div class="flex gap-3">
                <button onclick="closeAdminInput()" class="flex-1 py-3 bg-gray-700 rounded-xl font-bold text-gray-300">Cancelar</button>
                <button onclick="confirmAdminInput()" class="flex-1 py-3 bg-[#00a884] text-[#111b21] rounded-xl font-bold">Enviar</button>
            </div>
        </div>
    </div>
    
    <div id="customModal" class="hidden fixed inset-0 z-[80] flex items-center justify-center bg-black/90 backdrop-blur-sm p-4 animate-pop">
        <div class="glass-card p-6 w-full max-w-sm text-center border border-[#00a884] relative bg-[#202c33]">
            <i id="customModalIcon" class="fas fa-question-circle text-5xl text-[#00a884] mb-4"></i>
            <h3 id="customModalTitle" class="text-xl font-bold text-white mb-2">Título</h3>
            <p id="customModalMsg" class="text-gray-300 text-sm mb-6">Mensagem aqui</p>
            <input id="customModalInput" class="solid-input mb-4 hidden" placeholder="...">
            <div class="flex gap-3">
                <button onclick="closeCustomModal()" class="flex-1 py-3 bg-gray-700 rounded-xl font-bold text-gray-300">CANCELAR</button>
                <button id="customModalAction" class="flex-1 py-3 bg-[#00a884] text-[#111b21] rounded-xl font-bold">CONFIRMAR</button>
            </div>
        </div>
    </div>

    <!-- Modais Ocultos -->
    <div id="spyModal" class="hidden fixed inset-0 z-[70] flex items-center justify-center bg-black/95 backdrop-blur-xl p-4 animate-pop"><div class="glass-card w-full max-w-2xl h-[90vh] flex flex-col relative border border-[#00a884] shadow-lg"><div class="p-4 border-b border-gray-700 flex justify-between items-center bg-[#202c33] rounded-t-2xl"><h3 class="font-bold text-white"><i class="fas fa-user-secret mr-2"></i> MODO ESPIÃO</h3><button onclick="closeSpyModal()" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button></div><div id="spyContent" class="flex-1 flex flex-col p-6 overflow-hidden bg-[#0b141a]"></div></div></div>
    <div id="quizModal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black p-4"><div class="glass-card p-6 w-full max-w-lg bg-[#202c33] border border-[#00a884]"><button onclick="closeQuiz()" class="absolute top-4 right-4 text-gray-500"><i class="fas fa-times text-xl"></i></button><div id="quizContent"></div></div></div>
    <div id="adminProfileModal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4"><div class="glass-card w-full max-w-md p-8 rounded-3xl relative animate-pop bg-[#202c33]"><button onclick="closeAdminProfile()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button><div id="adminProfileContent"></div></div></div>
    <div id="msgModal" class="hidden fixed inset-0 z-40 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"><div class="glass-card p-6 w-full max-w-md relative bg-[#202c33]"><button onclick="closeMsgModal()" class="absolute top-4 right-4 text-gray-500 text-xl"><i class="fas fa-times"></i></button><h2 class="text-xl font-bold mb-4 text-[#00a884]"><i class="fas fa-envelope mr-2"></i> Notificações</h2><div id="msgList" class="space-y-4 max-h-60 overflow-y-auto"></div></div></div>

    <script>
        // --- CHAVE NOVA PARA RESETAR DADOS BUGADOS ---
        const APP_KEY = 'osmaismais_v56_ultimate_clean';
        const SESSION_KEY = 'osmaismais_session_v56';
        
        // --- SISTEMA DE DADOS SEGURO ---
        function getDatabase() {
            try {
                const data = localStorage.getItem(APP_KEY);
                if (!data) return createDefaultDB();
                const parsed = JSON.parse(data);
                if (!parsed.users || !Array.isArray(parsed.users)) return createDefaultDB();
                return parsed;
            } catch(e) {
                return createDefaultDB();
            }
        }
        function createDefaultDB() {
            return { users: [], logs: [], supportBox: [], reports: [], chats: [], maintenance: false };
        }
        function saveDatabase(data) { localStorage.setItem(APP_KEY, JSON.stringify(data)); }

        function showToast(title, msg) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast-item';
            let colorClass = 'text-[#00a884]';
            let icon = '<i class="fas fa-check-circle text-[#00a884] text-xl"></i>';
            if (title.includes("Erro") || title.includes("Bloqueado")) {
                toast.style.borderLeftColor = '#ef4444'; colorClass = 'text-red-500'; icon = '<i class="fas fa-exclamation-circle text-red-500 text-xl"></i>';
            }
            toast.innerHTML = `<div>${icon}</div><div><h4 class="font-bold text-sm uppercase ${colorClass}">${title}</h4><p class="text-xs text-gray-300">${msg}</p></div>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        let customModalCallback = null;
        function showCustomModal({ title, msg, icon = 'fa-question-circle', showInput = false, inputPlaceholder = '', onConfirm }) {
            document.getElementById('customModalTitle').innerText = title;
            document.getElementById('customModalMsg').innerText = msg;
            document.getElementById('customModalIcon').className = `fas ${icon} text-5xl text-[#00a884] mb-4`;
            const input = document.getElementById('customModalInput');
            if (showInput) { input.classList.remove('hidden'); input.value = ''; input.placeholder = inputPlaceholder; input.focus(); } else { input.classList.add('hidden'); }
            customModalCallback = () => { const val = showInput ? input.value : true; if (showInput && !val) return showToast('Erro', 'Preencha o campo'); onConfirm(val); closeCustomModal(); };
            document.getElementById('customModal').classList.remove('hidden');
        }
        function closeCustomModal() { document.getElementById('customModal').classList.add('hidden'); customModalCallback = null; }
        document.getElementById('customModalAction').onclick = () => { if (customModalCallback) customModalCallback(); };

        function formatDate(isoString) {
            if (!isoString) return '--:--';
            const date = new Date(isoString);
            return date.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' }) + ' ' + date.toLocaleDateString('pt-PT', { day: '2-digit', month: '2-digit' });
        }

        function ensureAdmin() {
            const db = getDatabase();
            const admins = [
                { name: 'Bárbara Henrique', pass: '123', gender: 'female' }, 
                { name: 'Lucas Pedro', pass: '123', gender: 'male' },
                { name: 'Lucas Freire 80', pass: '123', gender: 'male' }
            ];
            let changed = false;
            admins.forEach(ad => {
                let existing = db.users.find(u => u.name.toLowerCase() === ad.name.toLowerCase());
                if (!existing) {
                    db.users.push({ 
                        id: 'admin_' + ad.name.replace(/\s+/g, '').toLowerCase(), name: ad.name, password: ad.pass, role: 'admin', 
                        photo: null, gender: ad.gender, messages: [], lastLogin: null, lastLogout: null, isOnline: false 
                    });
                    changed = true;
                } else if (existing.role !== 'admin') { existing.role = 'admin'; changed = true; }
            });
            if(changed) saveDatabase(db);
        }

        const geniusQuiz = [
            { q: "Quanto é 7 x 8 + 4 - 10?", options: ["42", "50", "60", "56"], ans: 1 },
            { q: "Capital da Austrália?", options: ["Sydney", "Melbourne", "Canberra", "Perth"], ans: 2 }
        ]; 
        let currentQuizIndex = 0;
        let maintenanceCheckInterval = null;
        let currentAdminAction = null;
        let currentTargetId = null;
        let chatInterval = null;
        let spyInterval = null;

        const appDiv = document.getElementById('app');

        function init() {
            try {
                ensureAdmin();
                const user = getCurrentUser();
                
                // Redirecionamento Inicial
                if (user) {
                    // Já logado
                    if (user.role === 'admin') {
                         renderAdmin(user);
                    } else {
                         // Verifica banimento antes de mostrar painel
                         if (checkBanned(user)) {
                             renderBanned(user);
                         } else {
                             renderUser(user);
                             checkNotifications(user);
                         }
                    }
                    
                    // Loop de manutenção/atualização
                    if (maintenanceCheckInterval) clearInterval(maintenanceCheckInterval);
                    maintenanceCheckInterval = setInterval(checkGlobalMaintenance, 2000);

                } else {
                    renderLogin();
                }

            } catch (e) {
                console.error("Erro Fatal no Init:", e);
                localStorage.removeItem(APP_KEY);
                location.reload();
            }
        }

        // --- CORE: VERIFICAÇÃO DE ESTADO ---
        function checkGlobalMaintenance() {
            const db = getDatabase();
            const user = getCurrentUser();
            
            // Se não tem user, não faz sentido verificar ban/etc aqui, o login trata disso
            if (!user) {
                // Se o site está em manutenção e estamos no login, podemos mostrar o aviso, mas o login já trata disso
                return;
            }

            // PRIORIDADE: SE ESTIVER BANIDO
            if (user.role !== 'admin' && checkBanned(user)) {
                if (!document.getElementById('bannedScreen')) {
                    renderBanned(user);
                }
                return; 
            }

            const isAdminView = document.body.innerText.includes("PAINEL ADMIN");
            const isUserView = document.getElementById('userPanel') !== null;
            const isMaintenanceView = document.body.innerText.includes("SITE FECHADO");

            if (db.maintenance) {
                if (user.role !== 'admin') { 
                    // Expulsar user comum
                    localStorage.removeItem(SESSION_KEY); 
                    renderMaintenance(); 
                    return; 
                }
                if (!isAdminView) renderAdmin(user);
            } else {
                // Site normal
                if (user.role === 'admin') { 
                    if (!isAdminView) renderAdmin(user); 
                } else { 
                    if (!isUserView) { renderUser(user); checkNotifications(user); } 
                }
            }
        }

        function getCurrentUser() { const id = localStorage.getItem(SESSION_KEY); return id ? getDatabase().users.find(u => u.id === id) : null; }
        
        function checkBanned(user) { 
            if (!user.banned) return false; 
            if (user.banned.type === 'permanent') return true; 
            if (user.banned.expires && new Date(user.banned.expires) > new Date()) return true;
            // Se expirou
            const db = getDatabase(); db.users.find(u => u.id === user.id).banned = false; saveDatabase(db); return false; 
        }
        
        function checkNotifications(user) { const unread = (user.messages || []).filter(m => !m.read); if (unread.length > 0) { showToast("Admin", `Tens ${unread.length} mensagem(ns).`); } }
        
        function renderMaintenance() {
            appDiv.innerHTML = `<div class="glass-card p-10 text-center border-4 border-red-600 w-full max-w-lg animate-siren"><i class="fas fa-lock text-8xl text-red-500 mb-6"></i><h1 class="text-4xl font-black text-white mb-2">SITE FECHADO</h1><p class="text-xl font-bold text-red-400 mb-8">MANUTENÇÃO</p><button onclick="renderLogin(false)" class="w-full py-4 bg-gray-800 hover:bg-gray-700 text-white rounded-xl font-black">SOU ADMINISTRADOR</button></div>`;
        }

        function renderLogin(isRegister = false) { 
            appDiv.innerHTML = `
                <div class="w-full max-w-sm animate-pop">
                    <div class="glass-card p-8 text-center relative overflow-hidden bg-[#202c33]">
                        <div class="w-20 h-20 bg-[#00a884] rounded-full mx-auto mb-4 flex items-center justify-center text-2xl font-black shadow-lg">M+</div>
                        <h1 class="text-3xl font-bold mb-2 text-[#e9edef]">Os Mais Mais</h1>
                        <p class="text-gray-400 text-sm mb-8">Login Seguro</p>
                        
                        ${isRegister ? `
                            <!-- REGISTRO CORRIGIDO -->
                            <div class="space-y-4 text-left">
                                <div><label class="text-xs font-bold text-gray-400 ml-1">NOME DE USUÁRIO</label><input id="regName" class="solid-input mt-1"></div>
                                <div><label class="text-xs font-bold text-gray-400 ml-1">SENHA</label><input id="regPass" type="password" class="solid-input mt-1"></div>
                                <div><label class="text-xs font-bold text-gray-400 ml-1">IDADE</label><input id="regAge" type="number" class="solid-input mt-1"></div>
                                <button id="regBtn" onclick="doRegister()" class="btn-action mt-2">CRIAR CONTA</button>
                                <button onclick="renderLogin(false)" class="w-full mt-2 text-xs text-gray-500 hover:text-white font-bold py-2">VOLTAR</button>
                            </div>
                        ` : `
                            <!-- LOGIN -->
                            <div class="space-y-4 text-left">
                                <div><label class="text-xs font-bold text-gray-400 ml-1">NOME</label><input id="name" class="solid-input mt-1"></div>
                                <div><label class="text-xs font-bold text-gray-400 ml-1">SENHA</label><input id="pass" type="password" class="solid-input mt-1"></div>
                                <button id="loginBtn" onclick="doLogin()" class="btn-action mt-2">ENTRAR</button>
                                <button onclick="renderLogin(true)" class="w-full mt-2 text-xs text-[#00a884] font-bold py-2 hover:underline">CRIAR NOVA CONTA</button>
                            </div>
                        `}
                        
                        <div class="mt-6 pt-4 border-t border-gray-700">
                            <button onclick="startQuiz()" class="text-xs text-gray-600 hover:text-white uppercase font-bold tracking-widest">Acesso Restrito</button>
                        </div>
                    </div>
                </div>`; 
        }

        // --- LÓGICA DE LOGIN ---
        function doLogin() {
            try {
                const nInput = document.getElementById('name');
                const pInput = document.getElementById('pass');
                if(!nInput || !pInput) return; // Segurança contra erro de troca de tela

                const n = nInput.value.trim();
                const p = pInput.value.trim();
                const db = getDatabase();

                if (!n || !p) return showToast('Erro', 'Preencha tudo.');

                if(db.maintenance) { 
                    if(!['bárbara henrique', 'lucas pedro', 'lucas freire 80'].includes(n.toLowerCase())) return renderMaintenance(); 
                }
                const u = db.users.find(x => x.name.toLowerCase() === n.toLowerCase() && x.password === p);
                if(u) { 
                    if(checkBanned(u)){ renderBanned(u); return; } 
                    localStorage.setItem(SESSION_KEY, u.id); 
                    u.lastLogin = new Date().toISOString(); 
                    u.isOnline = true; 
                    saveDatabase(db); 
                    
                    // FORÇA INIT IMEDIATO
                    init(); 
                } else { showToast('Erro', 'Dados Incorretos'); }
            } catch(e) {
                console.error(e);
            }
        }

        // --- LÓGICA DE REGISTRO CORRIGIDA ---
        function doRegister() {
            const btn = document.getElementById('regBtn');
            if(btn) btn.innerText = "...";
            
            try {
                const db = getDatabase();
                if(db.maintenance) return renderMaintenance(); 
                
                // Pega os elementos com segurança
                const nInput = document.getElementById('regName');
                const pInput = document.getElementById('regPass');
                const aInput = document.getElementById('regAge');

                if(!nInput || !pInput || !aInput) {
                    // Se os elementos não existem, algo está errado com o render, recarrega
                    return renderLogin(true);
                }

                const n = nInput.value.trim();
                const p = pInput.value.trim();
                const a = aInput.value;
                
                if(!n||!p||!a) {
                    if(btn) btn.innerText = "CRIAR CONTA";
                    return showToast('Erro', 'Preencha tudo');
                }
                
                if(db.users.find(x => x.name.toLowerCase() === n.toLowerCase())) {
                    if(btn) btn.innerText = "CRIAR CONTA";
                    if(['bárbara henrique', 'lucas pedro', 'lucas freire 80'].includes(n.toLowerCase())) return showToast('Aviso', 'Admin já existe! Use o botão ENTRAR.');
                    return showToast('Erro', 'Nome já existe.');
                }
                
                const nu = { 
                    id: Date.now().toString(), name: n, password: p, age: a, role: 'user', 
                    themePref: 'dark', banned: false, messages: [], photo: null, 
                    lastLogin: new Date().toISOString(), lastLogout: null, isOnline: true
                };
                db.users.push(nu); 
                saveDatabase(db); 
                localStorage.setItem(SESSION_KEY, nu.id); 
                
                showToast('Sucesso', 'A entrar...');
                
                // ENTRADA IMEDIATA
                if(nu.role === 'admin') renderAdmin(nu);
                else renderUser(nu);
                
                // Inicia loop de verificação
                if (maintenanceCheckInterval) clearInterval(maintenanceCheckInterval);
                maintenanceCheckInterval = setInterval(checkGlobalMaintenance, 2000);

            } catch(e) {
                console.error(e);
                if(btn) btn.innerText = "CRIAR CONTA";
                showToast('Erro', 'Erro crítico. Tente recarregar.');
            }
        }

        function logout() { const id=localStorage.getItem(SESSION_KEY); if(id){const db=getDatabase(); const u=db.users.find(x=>x.id===id); if(u){u.lastLogout=new Date().toISOString(); u.isOnline=false; saveDatabase(db);}} localStorage.removeItem(SESSION_KEY); if(chatInterval) clearInterval(chatInterval); init(); }
        
        function startQuiz() { currentQuizIndex = 0; document.getElementById('quizModal').classList.remove('hidden'); renderQuizQuestion(); }
        function closeQuiz() { document.getElementById('quizModal').classList.add('hidden'); }
        function renderQuizQuestion() { const q = geniusQuiz[currentQuizIndex]; document.getElementById('quizContent').innerHTML = `<div class="text-center mb-6"><h3 class="text-xl font-bold text-white mb-6 text-center">${q.q}</h3><div class="grid gap-3">${q.options.map((opt, i) => `<div onclick="checkAnswer(${i})" class="bg-[#111b21] border border-gray-600 p-3 rounded-lg text-white hover:bg-[#00a884] cursor-pointer">${opt}</div>`).join('')}</div>`; }
        function checkAnswer(idx) { if (idx === geniusQuiz[currentQuizIndex].ans) { currentQuizIndex++; if (currentQuizIndex >= geniusQuiz.length) showQuizVictory(); else renderQuizQuestion(); } else { document.getElementById('quizContent').innerHTML = `<div class="text-center py-6"><h2 class="text-2xl font-bold text-red-500 mb-2">ERROU</h2><button onclick="closeQuiz()" class="btn-action bg-red-600 mt-4">SAIR</button></div>`; } }
        function showQuizVictory() { document.getElementById('quizContent').innerHTML = `<div class="text-center py-6"><h2 class="text-2xl font-bold text-[#00a884] mb-2">ACESSO ADMIN</h2><p>Bárbara Henrique<br>Lucas Pedro</p><p class="text-xs text-gray-500 mt-2">Senha: 123</p><button onclick="closeQuiz()" class="btn-action mt-4">OK</button></div>`; }
        function toggleMaintenance() { const db=getDatabase(); db.maintenance=!db.maintenance; saveDatabase(db); showToast('Sistema', db.maintenance?'FECHADO':'ABERTO'); renderAdmin(getCurrentUser()); }
        
        function openSpyModal(targetId) { if (spyInterval) clearInterval(spyInterval); currentTargetId = targetId; document.getElementById('spyModal').classList.remove('hidden'); updateSpyContent(); spyInterval = setInterval(updateSpyContent, 2000); }
        function closeSpyModal() { document.getElementById('spyModal').classList.add('hidden'); if (spyInterval) clearInterval(spyInterval); }
        function updateSpyContent() {
            const db = getDatabase(); const u = db.users.find(x => x.id === currentTargetId);
            if (!u) return closeSpyModal();
            const partner = u.partnerId ? db.users.find(x => x.id === u.partnerId) : null;
            const chatLogs = db.chats.filter(c => c.fromId === u.id || c.toId === u.id).sort((a,b) => a.timestamp - b.timestamp);
            const content = document.getElementById('spyContent');
            content.innerHTML = `<div class="flex items-center gap-4 mb-6 pb-6 border-b border-gray-800"><img src="${u.photo || `https://api.dicebear.com/7.x/avataaars/svg?seed=${u.name}`}" class="w-20 h-20 rounded-full border-4 border-red-600 bg-gray-900"><div><h2 class="text-3xl font-black text-white">${u.name}</h2><div class="flex gap-4 text-sm mt-1"><span class="text-gray-400 bg-gray-800 px-2 py-1 rounded">Senha: <b class="text-white">${u.password}</b></span><span class="text-gray-400 bg-gray-800 px-2 py-1 rounded">Email: <b class="text-white">${u.email || 'N/A'}</b></span></div><div class="mt-2 text-sm text-blue-400">Parceiro: <b class="text-white">${partner ? partner.name : (u.partnerDisplay ? u.partnerDisplay.name + ' (Visual)' : 'Nenhum')}</b></div></div></div><div class="flex-1 bg-black/50 rounded-xl p-4 overflow-y-auto flex flex-col gap-2 border border-gray-800"><h3 class="text-xs font-bold text-gray-500 uppercase mb-2 sticky top-0 bg-black/80 p-2">Histórico de Conversa (Ao Vivo)</h3>${chatLogs.length === 0 ? '<p class="text-gray-600 text-center text-sm py-10">Nenhuma conversa encontrada.</p>' : ''}${chatLogs.map(log => {const isTarget = log.fromId === u.id; const senderName = isTarget ? u.name : (log.fromId === u.partnerId && partner ? partner.name : 'Outro'); return `<div class="flex flex-col ${isTarget ? 'items-end' : 'items-start'}"><span class="text-[10px] text-gray-500 mb-1 px-1">${senderName} • ${new Date(log.timestamp).toLocaleTimeString()}</span><div class="${isTarget ? 'chat-me' : 'chat-partner'} text-sm px-3 py-2 rounded-lg">${log.text}</div></div>`; }).join('')}</div>`;
        }

        function openAdminProfile() { const u = getCurrentUser(); document.getElementById('adminProfileModal').classList.remove('hidden'); renderAdminProfileContent(u); }
        function closeAdminProfile() { document.getElementById('adminProfileModal').classList.add('hidden'); renderAdmin(getCurrentUser()); }
        function renderAdminProfileContent(u) { document.getElementById('adminProfileContent').innerHTML = `<div class="text-center"><h2 class="text-2xl font-black text-white">${u.name}</h2><p class="text-yellow-500 font-bold text-xs uppercase mb-6">Admin</p><div class="text-left space-y-4"><div><label class="text-xs font-bold text-gray-500">ALTERAR SENHA</label><input id="adminNewPass" value="${u.password}" class="solid-input !bg-black !border-yellow-900/50 text-yellow-100"></div><button onclick="saveAdminProfile()" class="w-full py-3 bg-yellow-600 hover:bg-yellow-500 text-black font-black rounded-xl uppercase">Salvar Alterações</button></div></div>`; }
        function saveAdminProfile() { const p = document.getElementById('adminNewPass').value.trim(); if(!p) return alert("Senha vazia!"); const db = getDatabase(); db.users.find(x => x.id === getCurrentUser().id).password = p; saveDatabase(db); alert("Perfil de Admin Atualizado!"); closeAdminProfile(); }

        // --- SISTEMA DE BANIMENTO FIXO (ATUALIZADO) ---
        function renderBanned(user) {
            const reason = user.banned.reason || "Violação das regras.";
            appDiv.innerHTML = `
                <div id="bannedScreen" class="fixed inset-0 bg-[#0b141a] z-50 flex items-center justify-center p-4">
                    <div class="glass-card p-8 text-center border-2 border-red-600 w-full max-w-md animate-pop relative">
                        <i class="fas fa-ban text-8xl text-red-500 mb-6 drop-shadow-lg"></i>
                        <h1 class="text-4xl font-black text-white mb-2 tracking-tighter">CONTA BLOQUEADA</h1>
                        <div class="bg-black/40 p-4 rounded-xl mb-6 border border-red-500/30">
                            <p class="text-red-200 text-xs font-bold uppercase mb-1">MOTIVO:</p>
                            <p class="text-white font-bold text-lg">"${reason}"</p>
                        </div>
                        <div class="bg-black/40 p-4 rounded-xl mb-6 text-left border border-white/10">
                            <label class="text-xs font-bold text-gray-400 mb-2 block uppercase"><i class="fas fa-pray mr-1"></i> Pedir Segunda Chance</label>
                            <textarea id="appealText" class="solid-input h-24 mb-2 !text-sm !bg-gray-900 border-gray-700" placeholder="Mensagem para o Administrador..."></textarea>
                            <button onclick="sendAppeal('${user.id}')" class="w-full bg-white text-red-900 font-black py-3 rounded-xl text-sm hover:bg-gray-200 transition">ENVIAR APELO</button>
                        </div>
                        <button onclick="logout()" class="text-red-400 font-bold text-xs hover:text-white uppercase tracking-widest border border-red-500/30 px-4 py-2 rounded-lg">Sair da Conta</button>
                    </div>
                </div>
            `;
        }

        function toggleBan(id, doBan) {
            const db = getDatabase();
            const u = db.users.find(x => x.id === id);
            if (doBan) {
                showCustomModal({
                    title: "Banir Utilizador",
                    msg: "Escreva o motivo para o utilizador ver:",
                    icon: 'fa-gavel',
                    showInput: true,
                    inputPlaceholder: "Ex: Linguagem ofensiva",
                    onConfirm: (reason) => {
                        u.banned = { type: 'permanent', reason: reason };
                        saveDatabase(db);
                        renderAdmin(getCurrentUser());
                    }
                });
            } else {
                u.banned = false;
                saveDatabase(db);
                renderAdmin(getCurrentUser());
            }
        }

        function sendAppeal(userId) {
            const t = document.getElementById('appealText').value.trim();
            if(!t) return showToast('Erro', 'Escreve alguma coisa');
            const db = getDatabase();
            const u = db.users.find(x => x.id === userId);
            db.supportBox.unshift({
                userName: u.name + " [BLOQUEADO]",
                userId: u.id,
                text: "[PEDIDO DE DESBLOQUEIO] " + t,
                date: new Date().toLocaleString(),
                resolved: false
            });
            saveDatabase(db);
            alert("O teu pedido foi enviado aos Administradores. Aguarda.");
            document.getElementById('appealText').value = '';
        }

        function saveProfile() { const n=document.getElementById('newName').value.trim(), p=document.getElementById('newPass').value.trim(); if(!n) return; const db=getDatabase(), u=db.users.find(x=>x.id===getCurrentUser().id); u.name=n; if(p) u.password=p; saveDatabase(db); showToast('Ok', 'Salvo'); renderUser(u,'perfil'); }
        function linkPartner() { const t=document.getElementById('partnerSearch').value.trim(); if(!t)return; const db=getDatabase(); const u=db.users.find(x=>x.id===getCurrentUser().id); const target=db.users.find(x=>x.name===t); if(target){if(target.id===u.id||target.partnerId)return showToast('Erro','Inválido'); showCustomModal({title:"Parceiro Encontrado!",msg:`Desejas iniciar a participação com ${target.name}?`,icon:'fa-user-check',confirmText:'PARTICIPAR COM ELE',confirmColor:'bg-[#00a884]',onConfirm:()=>{u.partnerId=target.id; target.partnerId=u.id; u.partnerDisplay=null; saveDatabase(db); showToast('Sucesso','Participação iniciada!'); renderUser(u,'parceiro');}});}else{showCustomModal({title:"Utilizador Desconhecido",msg:`"${t}" não foi encontrado. Queres criar um perfil visual?`,icon:'fa-user-slash',showInput:true,inputPlaceholder:"Digite a idade",onConfirm:(age)=>{u.partnerDisplay={name:t,age:age};u.partnerId=null;saveDatabase(db);renderUser(u,'parceiro');}});}}
        function removePartner() { showCustomModal({title:"Remover Parceiro",msg:"Tens a certeza?",icon:'fa-heart-broken',onConfirm:()=>{const db=getDatabase(), u=db.users.find(x=>x.id===getCurrentUser().id); if(u.partnerId){const p=db.users.find(x=>x.id===u.partnerId); if(p)p.partnerId=null; u.partnerId=null;} u.partnerDisplay=null; saveDatabase(db); renderUser(u,'parceiro');}}); }
        function sendChat() { const t=document.getElementById('chatInput').value.trim(); if(!t)return; const u=getCurrentUser(), db=getDatabase(); db.chats.push({fromId:u.id, toId:u.partnerId, text:t, timestamp:Date.now(), read:false}); saveDatabase(db); document.getElementById('chatInput').value=''; loadChat(); }
        function loadChat() { const u=getCurrentUser(), db=getDatabase(), area=document.getElementById('chatArea'); if(!area)return; let hasUpdate=false; db.chats.forEach(c=>{if(c.toId===u.id&&!c.read){c.read=true;hasUpdate=true;}}); if(hasUpdate)saveDatabase(db); const msgs=db.chats.filter(c=>(c.fromId===u.id&&c.toId===u.partnerId)||(c.fromId===u.partnerId&&c.toId===u.id)); area.innerHTML=msgs.map(m=>`<div class="flex ${m.fromId===u.id?'justify-end':'justify-start'}"><div class="chat-bubble ${m.fromId===u.id?'chat-me':'chat-partner'}">${m.text}<div class="chat-time">${new Date(m.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div></div></div>`).join(''); area.scrollTop=area.scrollHeight; }
        function sendSupport() { const t=document.getElementById('supportMsg').value.trim(); if(!t)return; const db=getDatabase(); db.reports.unshift({reporterName:getCurrentUser().name, description:'SUPORTE: '+t, date:new Date().toLocaleString()}); saveDatabase(db); document.getElementById('supportMsg').value=''; showToast('Ok', 'Enviado'); }
        function sendReport() { const d=document.getElementById('reportDesc').value; if(!d&&!tempReportImage)return showToast('Erro','Vazio'); const db=getDatabase(); db.reports.unshift({reporterName:getCurrentUser().name, description:d, image:tempReportImage, date:new Date().toLocaleString()}); saveDatabase(db); tempReportImage=null; showToast('Ok','Denúncia Enviada'); renderUser(getCurrentUser(),'denunciar'); }
        function previewReport(i) { if(i.files[0]){const r=new FileReader(); r.onload=(e)=>{tempReportImage=e.target.result;document.getElementById('reportPreview').src=e.target.result;document.getElementById('reportPreview').classList.remove('hidden')}; r.readAsDataURL(i.files[0]);}}
        function uploadPhoto(i) { if(i.files[0]){const r=new FileReader(); r.onload=(e)=>{const db=getDatabase(); db.users.find(x=>x.id===getCurrentUser().id).photo=e.target.result; saveDatabase(db); renderUser(getCurrentUser(),'perfil')}; r.readAsDataURL(i.files[0]);}}
        function delReport(idx){const db=getDatabase(); db.reports.splice(idx,1); saveDatabase(db); renderAdmin(getCurrentUser());}
        function openAdminInput(act,idx,id){currentAdminAction=act;currentTargetId=id;window.currentMsgIdx=idx;document.getElementById('adminInputModal').classList.remove('hidden');}
        function closeAdminInput(){document.getElementById('adminInputModal').classList.add('hidden');}
        function confirmAdminInput(){const t=document.getElementById('adminInputText').value; const db=getDatabase(); const u=db.users.find(x=>x.id===currentTargetId); if(u){if(!u.messages)u.messages=[]; u.messages.push({from:'Administrador',text:t,read:false}); if(currentAdminAction==='reply' && window.currentMsgIdx!==null) db.supportBox[window.currentMsgIdx].resolved=true; saveDatabase(db); showToast('Ok','Enviado'); closeAdminInput();}}
        function toggleMsgModal(){const el=document.getElementById('msgModal'); if(el.classList.contains('hidden')){const u=getCurrentUser(); document.getElementById('msgList').innerHTML=u.messages.length?u.messages.map(m=>`<div class="bg-gray-800 p-3 rounded mb-2"><p class="font-bold text-[#00a884]">${m.from}</p><p class="text-white">${m.text}</p></div>`).join(''):'Vazio'; const db=getDatabase(); db.users.find(x=>x.id===u.id).messages.forEach(m=>m.read=true); saveDatabase(db); el.classList.remove('hidden');}else el.classList.add('hidden');}
        function closeMsgModal(){document.getElementById('msgModal').classList.add('hidden'); renderUser(getCurrentUser());}
        function promptChangePassword(id) { openAdminProfile(); }
        function startQuiz() { currentQuizIndex = 0; document.getElementById('quizModal').classList.remove('hidden'); renderQuizQuestion(); }
        function closeQuiz() { document.getElementById('quizModal').classList.add('hidden'); }
        function renderQuizQuestion() { const q = geniusQuiz[currentQuizIndex]; document.getElementById('quizContent').innerHTML = `<div class="text-center mb-6"><h3 class="text-xl font-bold text-white mb-6 text-center">${q.q}</h3><div class="grid gap-3">${q.options.map((opt, i) => `<div onclick="checkAnswer(${i})" class="bg-[#111b21] border border-gray-600 p-3 rounded-lg text-white hover:bg-[#00a884] cursor-pointer">${opt}</div>`).join('')}</div>`; }
        function checkAnswer(idx) { if (idx === geniusQuiz[currentQuizIndex].ans) { currentQuizIndex++; if (currentQuizIndex >= geniusQuiz.length) showQuizVictory(); else renderQuizQuestion(); } else { document.getElementById('quizContent').innerHTML = `<div class="text-center py-6"><h2 class="text-2xl font-bold text-red-500 mb-2">ERROU</h2><button onclick="closeQuiz()" class="btn-action bg-red-600 mt-4">SAIR</button></div>`; } }
        function showQuizVictory() { document.getElementById('quizContent').innerHTML = `<div class="text-center py-6"><h2 class="text-2xl font-bold text-[#00a884] mb-2">ACESSO ADMIN</h2><p>Bárbara Henrique<br>Lucas Pedro</p><p class="text-xs text-gray-500 mt-2">Senha: 123</p><button onclick="closeQuiz()" class="btn-action mt-4">OK</button></div>`; }
        function toggleMaintenance() { const db=getDatabase(); db.maintenance=!db.maintenance; saveDatabase(db); showToast('Sistema', db.maintenance?'FECHADO':'ABERTO'); renderAdmin(getCurrentUser()); }
        
        function adminRemovePartner(userId) {
            if(!confirm("Remover parceiro deste usuário?")) return;
            const db = getDatabase();
            const u = db.users.find(x => x.id === userId);
            if (u) {
                if (u.partnerId) {
                    const p = db.users.find(x => x.id === u.partnerId);
                    if (p) { p.partnerId = null; p.messages.push({from: 'Sistema', text: 'O Administrador removeu o teu parceiro.', date: new Date().toLocaleString(), read: false}); }
                }
                u.partnerId = null;
                u.partnerDisplay = null;
                u.messages.push({from: 'Sistema', text: 'O Administrador removeu o teu parceiro.', date: new Date().toLocaleString(), read: false});
                saveDatabase(db);
                renderAdmin(getCurrentUser());
                showToast("Sucesso", "Parceiro removido.");
            }
        }
        
        function renderAdmin(admin) {
            const db = getDatabase(); const users = db.users.filter(u => u.role !== 'admin'); const reports = db.reports || [];
            appDiv.innerHTML = `
                <div class="w-full max-w-5xl glass-card p-6 min-h-[90vh]">
                    <div class="flex justify-between items-center mb-8 border-b border-gray-700 pb-4">
                        <h1 class="text-2xl font-bold text-[#e9edef]">PAINEL ADMIN</h1>
                        <button onclick="logout()" class="text-red-400 font-bold text-xs">SAIR</button>
                    </div>
                    <button onclick="toggleMaintenance()" class="w-full mb-8 py-4 rounded-xl font-bold shadow-lg transition-all ${db.maintenance ? 'bg-red-600 text-white' : 'bg-[#00a884] text-[#111b21]'}">${db.maintenance ? 'ABRIR SITE' : 'FECHAR SITE'}</button>
                    
                    <div class="mb-8 p-4 bg-[#111b21] rounded-2xl border border-red-900/30">
                        <h3 class="text-sm font-bold text-red-400 mb-4 uppercase">Denúncias (${reports.length})</h3>
                        <div class="space-y-3 max-h-60 overflow-y-auto no-scrollbar">
                            ${reports.length === 0 ? '<p class="text-center text-gray-600 text-sm py-4"><i class="fas fa-check-circle mr-2"></i> A LISTA DE DENÚNCIAS ESTÁ VAZIA</p>' : ''}
                            ${reports.map((r, i) => `<div class="bg-[#202c33] p-3 rounded-lg border border-red-500/20"><div class="flex justify-between text-xs text-gray-400"><span>${r.reporterName}</span><span>${r.date}</span></div><p class="text-sm text-gray-200 mt-1">${r.description}</p>${r.image?`<button onclick="window.open('${r.image}')" class="text-[#00a884] text-xs underline mt-1">Ver Imagem</button>`:''}<button onclick="delReport(${i})" class="w-full mt-2 bg-red-900/30 text-red-300 text-xs py-1 rounded">Apagar</button></div>`).join('')}
                        </div>
                    </div>

                    <h3 class="text-sm font-bold text-blue-400 mb-3 uppercase">Usuários (${users.length})</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${users.map(u => {
                            let partnerName = 'Nenhum';
                            if (u.partnerId) { const p = db.users.find(x => x.id === u.partnerId); partnerName = p ? p.name : 'Nenhum'; }
                            else if (u.partnerDisplay) partnerName = `${u.partnerDisplay.name} (V)`;

                            return `
                            <div class="bg-[#202c33] p-4 rounded-xl border border-gray-700 flex flex-col gap-3 relative">
                                <div class="flex justify-between items-start">
                                    <div class="flex gap-3">
                                        <div class="w-12 h-12 rounded-full bg-gray-700 overflow-hidden shrink-0">
                                            <img src="${u.photo || `https://api.dicebear.com/7.x/avataaars/svg?seed=${u.name}`}" class="w-full h-full object-cover">
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-[#e9edef] leading-tight">${u.name}</h4>
                                            <p class="text-[10px] text-gray-500 font-mono">${u.password}</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="text-[10px] font-bold ${u.isOnline ? 'text-green-400' : 'text-red-400'}">${u.isOnline ? 'ONLINE' : 'OFFLINE'}</span>
                                        ${u.banned ? '<span class="text-red-500 font-bold text-[10px]">BANIDO</span>' : ''}
                                    </div>
                                </div>
                                <div class="bg-[#111b21] p-2 rounded text-[10px] text-gray-400 space-y-1">
                                    <div class="flex justify-between"><span>Entrou:</span><span class="text-white">${formatDate(u.lastLogin)}</span></div>
                                    <div class="flex justify-between"><span>Saiu:</span><span class="text-white">${formatDate(u.lastLogout)}</span></div>
                                    <div class="flex justify-between border-t border-gray-700 pt-1 mt-1"><span class="text-blue-400">Parceiro:</span><span class="text-white">${partnerName}</span></div>
                                </div>
                                <div class="grid grid-cols-2 gap-2 mt-auto">
                                    <button onclick="openSpyModal('${u.id}')" class="bg-purple-600 text-white py-2 rounded text-[10px] font-bold col-span-2 hover:bg-purple-500">VER MENSAGENS (ESPIÃO)</button>
                                    <button onclick="adminRemovePartner('${u.id}')" class="bg-orange-600 text-white py-2 rounded text-[10px] font-bold col-span-2 hover:bg-orange-500">DESFAZER PARCERIA</button>
                                    <button onclick="openAdminInput('msg', null, '${u.id}')" class="bg-[#00a884] text-[#111b21] py-2 rounded text-[10px] font-bold">AVISAR</button>
                                    ${!u.banned ? 
                                        `<button onclick="toggleBan('${u.id}', true)" class="bg-red-600 text-white py-2 rounded text-[10px] font-bold">BANIR</button>` : 
                                        `<button onclick="toggleBan('${u.id}', false)" class="bg-green-600 text-white py-2 rounded text-[10px] font-bold">SOLTAR</button>`
                                    }
                                </div>
                            </div>`
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderUser(user, tab = 'perfil') {
            if (chatInterval) { clearInterval(chatInterval); chatInterval = null; }
            const db = getDatabase();
            const adminUnread = (user.messages || []).filter(m => !m.read).length;
            const chatUnread = db.chats.filter(c => c.toId === user.id && !c.read).length;
            
            appDiv.innerHTML = `
                <div id="userPanel" class="w-full max-w-4xl h-full flex flex-col md:flex-row gap-4 animate-pop">
                    <div class="flex-1 glass-card p-6 pb-24 md:pb-6 relative overflow-y-auto h-[85vh] md:h-auto flex flex-col">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-black text-white uppercase tracking-wide border-b-2 border-[#00a884] pb-1">${tab}</h2>
                            <button onclick="toggleMsgModal()" class="relative p-2 bg-[#2a3942] rounded-lg">
                                <i class="fas fa-bell text-[#00a884]"></i>
                                ${adminUnread > 0 ? `<div class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-[10px] flex items-center justify-center font-bold animate-bounce">${adminUnread}</div>` : ''}
                            </button>
                        </div>
                        <div class="flex-1">${getTabContent(user, tab)}</div>
                    </div>
                    <div class="fixed bottom-4 left-4 right-4 z-50 bg-[#202c33] border border-gray-700 rounded-2xl shadow-2xl p-2 flex justify-between items-center md:hidden">
                        <button onclick="renderUser(getCurrentUser(), 'perfil')" class="flex-1 py-3 text-center rounded-xl ${tab=='perfil'?'text-[#00a884] bg-[#2a3942]':'text-gray-500'}"><i class="fas fa-user text-xl"></i></button>
                        <button onclick="renderUser(getCurrentUser(), 'parceiro')" class="flex-1 py-3 text-center rounded-xl relative ${tab=='parceiro'?'text-[#00a884] bg-[#2a3942]':'text-gray-500'}"><i class="fas fa-heart text-xl"></i>${chatUnread > 0 ? `<div class="absolute top-2 right-2 w-3 h-3 bg-red-600 rounded-full"></div>` : ''}</button>
                        <button onclick="renderUser(getCurrentUser(), 'suporte')" class="flex-1 py-3 text-center rounded-xl ${tab=='suporte'?'text-[#00a884] bg-[#2a3942]':'text-gray-500'}"><i class="fas fa-headset text-xl"></i></button>
                        <button onclick="renderUser(getCurrentUser(), 'denunciar')" class="flex-1 py-3 text-center rounded-xl ${tab=='denunciar'?'text-[#00a884] bg-[#2a3942]':'text-gray-500'}"><i class="fas fa-exclamation-triangle text-xl"></i></button>
                        <button onclick="logout()" class="flex-1 py-3 text-center rounded-xl text-gray-500 hover:text-red-500"><i class="fas fa-sign-out-alt text-xl"></i></button>
                    </div>
                </div>
            `;
            if (tab === 'parceiro' && user.partnerId && !user.partnerDisplay) {
                loadChat();
                chatInterval = setInterval(loadChat, 2000);
            }
        }

        function getTabContent(user, tab) {
            if (tab === 'perfil') return `<div class="flex flex-col items-center mb-6"><div class="w-28 h-28 rounded-full border-4 border-[#00a884] overflow-hidden bg-gray-800 mb-3 relative group"><img src="${user.photo || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.name}`}" class="w-full h-full object-cover"><label class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition cursor-pointer"><i class="fas fa-camera text-2xl"></i><input type="file" class="hidden" onchange="uploadPhoto(this)"></label></div><h3 class="text-2xl font-black text-white">${user.name}</h3></div><div class="space-y-4"><div><label class="text-xs font-bold text-gray-400">EDITAR NOME</label><input id="newName" value="${user.name}" class="solid-input"></div><div><label class="text-xs font-bold text-gray-400">NOVA SENHA</label><input id="newPass" type="password" class="solid-input" placeholder="Nova senha..."></div><button onclick="saveProfile()" class="btn-action w-full mt-2">SALVAR</button></div>`;
            if (tab === 'parceiro') {
                if (user.partnerId && !user.partnerDisplay) {
                    const db = getDatabase(); const p = db.users.find(x => x.id === user.partnerId);
                    return `<div class="flex flex-col h-[60vh]"><div class="bg-[#202c33] p-3 rounded-t-xl flex justify-between items-center border-b border-gray-700"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-[#00a884] overflow-hidden"><img src="${p?.photo||''}" class="w-full h-full"></div><div><h4 class="font-bold text-white">${p?.name}</h4><span class="text-xs text-[#00a884]">Online</span></div></div><button onclick="removePartner()" class="text-red-400 font-bold text-xs bg-red-900/30 px-3 py-1 rounded">SAIR</button></div><div id="chatArea" class="flex-1 bg-black/30 overflow-y-auto p-4 flex flex-col gap-2 border-x border-gray-700"></div><div class="p-2 bg-[#202c33] rounded-b-xl flex gap-2"><input id="chatInput" class="solid-input !py-3 !text-sm" placeholder="Mensagem..."><button onclick="sendChat()" class="bg-[#00a884] text-[#111b21] px-4 rounded-xl"><i class="fas fa-paper-plane"></i></button></div></div>`;
                }
                return `<div class="text-center py-10"><i class="fas fa-search text-5xl text-gray-500 mb-4"></i><h3 class="text-xl font-bold mb-2">Encontrar Par</h3><p class="text-gray-400 text-sm mb-6">Digita o nome exato.</p><input id="partnerSearch" class="solid-input text-center mb-4" placeholder="Nome do Utilizador"><button onclick="linkPartner()" class="btn-action w-full">CONECTAR</button></div>`;
            }
            if (tab === 'suporte') return `<div class="bg-red-900/20 border border-red-500/30 p-4 rounded-xl mb-6 text-center"><h3 class="font-black text-red-400">ADMINISTRAÇÃO OCULTA</h3><p class="text-xs text-gray-300">"Estamos sempre a vigiar."</p></div><textarea id="supportMsg" class="solid-input h-32 mb-4" placeholder="Qual o problema?"></textarea><button onclick="sendSupport()" class="btn-action w-full">ENVIAR</button>`;
            if (tab === 'denunciar') return `<div class="text-center"><i class="fas fa-shield-alt text-4xl text-red-500 mb-4"></i><h3 class="text-xl font-bold mb-4">Denunciar</h3><textarea id="reportDesc" class="solid-input h-24 mb-4" placeholder="O que aconteceu?"></textarea><label class="block w-full p-4 border-2 border-dashed border-gray-600 rounded-xl mb-4 cursor-pointer hover:border-gray-400 bg-gray-800"><span class="text-xs font-bold text-gray-400">ANEXAR FOTO/PRINT</span><input type="file" class="hidden" accept="image/*" onchange="previewReport(this)"><img id="reportPreview" class="w-full mt-2 rounded hidden"></label><button onclick="sendReport()" class="btn-action w-full bg-red-600">ENVIAR</button></div>`;
        }

        init();
    </script>
</body>
</html>