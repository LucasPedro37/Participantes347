<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participa√ß√£o - Os Mais Mais</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --primary-color: #6a5acd; /* Roxo Azulado (SlateBlue) */
            --secondary-color: #007bff; /* Azul Brilhante */
            --dark-blue-color: #0056b3; /* Azul Escuro */
            --success-color: #28a745; /* Verde */
            --warning-color: #ff8c00; /* Laranja */
            --danger-color: #dc3545; /* Vermelho */
            --dark-bg: #12121f;
            --light-bg: #1e1e2f;
            --text-color: #e0e0e0;
            --text-light: #ffffff;
            --border-color: #333;
            --body-bg: #000;
        }

        body[data-theme="light"] {
            --primary-color: #6a5acd; /* Mantido */
            --secondary-color: #007bff; /* Mantido */
            --dark-blue-color: #0056b3; /* Mantido */
            --success-color: #28a745; /* Mantido */
            --warning-color: #ff8c00; /* Mantido */
            --danger-color: #dc3545; /* Mantido */
            --dark-bg: #f4f4f9;
            --light-bg: #ffffff;
            --text-color: #333333;
            --text-light: #121212;
            --border-color: #ddd;
            --body-bg: #f0f2f5;
        }

        body {
            background-color: var(--body-bg);
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .main-title {
            font-size: 3em;
            font-weight: 700;
            color: var(--text-light);
            text-shadow: 0 0 10px rgba(106, 90, 205, 0.7);
            margin-bottom: 40px;
        }

        .entry-animation {
            animation: entryAnimation 1s cubic-bezier(0.22, 1, 0.36, 1) both;
        }

        @keyframes entryAnimation {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
                filter: blur(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        .content-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
        }

        #user-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
            position: relative;
        }

        #theme-toggle-button {
            position: absolute;
            top: 50%;
            right: -50px;
            transform: translateY(-50%);
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }
        #theme-toggle-button:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--primary-color);
        }
        #theme-toggle-button svg {
            width: 20px;
            height: 20px;
            fill: var(--text-color);
            transition: fill 0.3s ease;
        }
        #theme-toggle-button:hover svg {
            fill: var(--primary-color);
        }

        #color-picker {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 38px;
            height: 38px;
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            padding: 0;
            transition: all 0.3s ease;
        }
        #color-picker::-webkit-color-swatch {
            border-radius: 50%;
            border: 3px solid var(--light-bg);
        }
        #color-picker::-moz-color-swatch {
            border-radius: 50%;
            border: 3px solid var(--light-bg);
        }
        #color-picker:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--primary-color);
        }
        #theme-toggle-button svg {
            width: 20px;
            height: 20px;
            fill: var(--text-color);
            transition: fill 0.3s ease;
        }
        #theme-toggle-button:hover svg {
            fill: var(--primary-color);
        }

        .profile-pic {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
            object-fit: cover;
            cursor: pointer;
        }

        #name-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            background: rgba(30, 30, 47, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 420px;
            width: 90%;
        }

        body[data-theme="light"] #name-container {
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        #main-content {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        #main-content .button-group {
            display: flex;
            gap: 20px;
            flex-direction: column; 
        }

        .button-group-horizontal {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        #nameInput {
            padding: 15px;
            font-size: 18px;
            border-radius: 15px;
            border: 2px solid transparent;
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--text-light);
            width: 100%;
            box-sizing: border-box;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        body[data-theme="light"] #nameInput {
            background-color: rgba(255, 255, 255, 0.5);
            color: var(--text-color);
            border-color: rgba(0,0,0,0.1);
        }

        #nameInput:focus {
            background-color: var(--light-bg);
            border-color: var(--primary-color);
            box-shadow: 0 0 15px var(--primary-color);
            transform: scale(1.02);
        }

        .btn {
            position: relative;
            color: var(--text-light);
            background: var(--dark-blue-color);
            padding: 20px 40px;
            font-size: 20px;
            font-weight: 600;
            border: none;
            border-radius: 40px;
            outline: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--dark-blue-color), 0 0 30px var(--dark-blue-color);
        }

        .btn:active {
            transform: scale(0.90);
            transition: transform 0.1s ease;
        }

        .btn-primary {
            /* Herda o estilo do .btn */
        }

        .btn-purple {
            margin-top: 20px;
        }

        .btn-red {
            background: var(--danger-color);
            border-color: var(--danger-color);
        }
        .btn-red:hover {
            box-shadow: 0 0 15px var(--danger-color), 0 0 30px var(--danger-color);
        }

        .btn-info {
            background: var(--secondary-color);
        }
        .btn-info:hover {
            box-shadow: 0 0 15px var(--secondary-color), 0 0 30px var(--secondary-color);
        }

        .btn-warning {
            background: var(--warning-color);
        }
        .btn-warning:hover { box-shadow: 0 0 15px var(--warning-color), 0 0 30px var(--warning-color); }

        #declineOptions {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        #loader {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        /* Novo estilo de Spinner */
        .spinner {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: radial-gradient(farthest-side, var(--primary-color) 94%, #0000) top/12px 12px no-repeat,
                        conic-gradient(#0000 30%, var(--primary-color));
            -webkit-mask: radial-gradient(farthest-side, #0000 calc(100% - 12px), #000 0);
            animation: spin 1s linear infinite;
        }

        #loader-text {
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 1px;
            margin-top: 15px;
            transition: opacity 0.5s ease-in-out;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #notification {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: var(--text-light);
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px var(--success-color);
            font-size: 16px;
        }

        #declineOptions {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border-radius: 15px;
            background-color: var(--light-bg);
            backdrop-filter: blur(5px);
        }
        
        #feedbackMessage {
            display: none;
            text-align: center;
            font-size: 20px;
            padding: 20px 30px;
            border-radius: 8px;
            background-color: var(--light-bg);
            color: var(--primary-color);
            box-shadow: 0 0 15px var(--dark-blue-color);
        }
        
        .option-btn {
            background-color: var(--light-bg);
            color: var(--text-light);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            width: 280px;
            font-size: 16px;
            transition: all 0.3s ease;
            text-align: center;
            font-family: 'Poppins', sans-serif;
        }

        #support-message-container textarea {
            width: 320px;
            height: 120px;
            resize: vertical;
            font-family: 'Poppins', sans-serif;
            padding: 15px;
            font-size: 16px;
            box-sizing: border-box; /* Garante que o padding n√£o aumente a largura */
        }


        .option-btn:hover {
            background-color: var(--dark-bg);
            border-color: var(--dark-blue-color);
            box-shadow: 0 0 8px var(--dark-blue-color);
        }

        .btn-green {
            color: var(--text-light);
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 30px;
            outline: none;
            background: var(--dark-blue-color);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-orange { background: var(--dark-blue-color); }
        .btn-orange:hover { box-shadow: 0 0 15px var(--dark-blue-color), 0 0 30px var(--dark-blue-color); }

        .btn-green:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--success-color), 0 0 30px var(--success-color);
        }

        footer {
            margin-top: 20px; /* Adicionado para espa√ßamento */
            padding-bottom: 10px;
            font-size: 12px;
            color: var(--text-color); /* Cor ajustada para o tema */
        }

        .footer-link {
            display: inline-flex;
            align-items: center;
            gap: 6px; /* Espa√ßo entre o √≠cone e o texto */
            vertical-align: middle; /* Alinha o conjunto verticalmente */
        }
        
        .footer-link {
            color: var(--secondary-color);
            text-decoration: none;
            transition: transform 0.3s ease, color 0.3s ease, text-shadow 0.3s ease;
        }
        .footer-link:hover {
            transform: translateY(-2px);
            text-shadow: 0 0 8px var(--secondary-color);
        }

        #partner-form-container {
            display: none;
            flex-direction: column;
            align-items: center;            
            background-color: var(--light-bg);
            padding: 20px; border-radius: 15px; backdrop-filter: blur(5px);
            gap: 15px;
        }

        #partner-form-container input {
            width: 300px;
        }

        #partner-error-message {
            color: var(--danger-color);
            display: none;
        }

        #block-list-container {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px;            
            background-color: var(--light-bg);
            padding: 20px; border-radius: 15px; backdrop-filter: blur(5px);
        }

        #blocked-users-list {
            list-style: none;
            padding: 0;
            width: 100%;
            max-width: 320px;
            text-align: center;
            max-height: 150px; /* Altura m√°xima antes de rolar */
            overflow-y: auto;  /* Adiciona barra de rolagem vertical quando necess√°rio */
            padding-right: 5px; /* Espa√ßo para a barra de rolagem */
        }
        #blocked-users-list li {
            background-color: var(--light-bg);
            padding: 10px; margin-bottom: 5px; border-radius: 5px; border: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
        }
        #blocked-users-list .unblock-btn { background: var(--success-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        
        /* Estilos da Nova Notifica√ß√£o Animada */
        .notification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .notification-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .notification-box {
            background: var(--light-bg);
            padding: 30px 50px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            transform: scale(0.7);
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        .notification-overlay.show .notification-box {
            transform: scale(1);
        }

        .notification-box h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: var(--success-color);
            font-size: 28px;
        }

        .notification-box p {
            font-size: 18px;
            color: var(--text-color);
        }

        /* Estilos para Notifica√ß√£o de Aviso (Vermelha) */
        .notification-box.warning h3 {
            color: var(--danger-color);
            animation: blink-red 1.5s infinite;
        }
        .notification-box.warning .checkmark {
            stroke: #ff4d4d;
        }

        /* Estilos para Notifica√ß√£o de Informa√ß√£o (Amarela) */
        .notification-box.info h3 {
            color: var(--warning-color);
        }
        .notification-box.info .checkmark {
            stroke: var(--warning-color);
        }

        /* Anima√ß√£o do √çcone de Check */
        .checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: block;
            stroke-width: 4;
            stroke: var(--success-color);
            stroke-miterlimit: 10;
            margin: 0 auto;
            box-shadow: inset 0px 0px 0px #4caf50;
        }

        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) 0.3s forwards;
        }

        .checkmark-check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        /* Anima√ß√£o do √çcone de Exclama√ß√£o */
        .exclamation-mark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: none; /* Escondido por padr√£o */
            stroke-width: 4;
            stroke-miterlimit: 10;
            margin: 0 auto;
        }

        .notification-box.warning .exclamation-mark { stroke: var(--danger-color); }
        .notification-box.info .exclamation-mark { stroke: var(--warning-color); }

        .exclamation-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            animation: stroke-exclamation-circle 0.6s cubic-bezier(0.65, 0, 0.45, 1) 0.3s forwards;
        }

        .exclamation-line {
            stroke-dasharray: 17;
            stroke-dashoffset: 17;
            animation: stroke-exclamation-line 0.2s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        .exclamation-dot {
            stroke-dasharray: 2;
            stroke-dashoffset: 2;
            animation: stroke-exclamation-dot 0.2s cubic-bezier(0.65, 0, 0.45, 1) 1s forwards;
        }

        @keyframes stroke-exclamation-circle { 100% { stroke-dashoffset: 0; } }
        @keyframes stroke-exclamation-line { 100% { stroke-dashoffset: 0; } }
        @keyframes stroke-exclamation-dot { 100% { stroke-dashoffset: 0; } }

        .notification-overlay.show .notification-box.warning,
        .notification-overlay.show .notification-box.info {
            animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
        }


        @keyframes wave {
            0%, 40%, 100% {
                transform: translateY(0);
            }
            20% {
                transform: translateY(-20px);
            }
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) scale(1); }
            20%, 80% { transform: translate3d(2px, 0, 0) scale(1); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0) scale(1); }
            40%, 60% { transform: translate3d(4px, 0, 0) scale(1); }
        }

        @keyframes blink-red {
            0%, 100% { color: var(--danger-color); text-shadow: 0 0 10px var(--danger-color); }
            50% { color: #ff7b7b; text-shadow: none; } /* Um tom mais claro de vermelho */
        }

        /* --- Media Queries para Responsividade --- */
        @media (max-width: 768px) {
            .main-title {
                font-size: 2.2em;
                text-align: center;
                margin-bottom: 30px;
            }

            .content-wrapper {
                padding: 0 20px;
                width: 100%;
                box-sizing: border-box;
            }

            #nameInput, .option-btn, #partner-form-container input {
                width: 90%;
                max-width: 320px;
            }

            .btn {
                font-size: 16px;
                padding: 15px 25px;
            }

            .notification-box {
                width: 90%;
                padding: 25px;
            }

            footer {
                position: relative;
                margin-top: 30px;
            }
        }

        /* --- Estilos da P√°gina de Manuten√ß√£o --- */
        #maintenance-container {
            display: none; /* Come√ßa escondido */
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 40px;
            background-color: var(--light-bg);
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(106, 90, 205, 0.5);
            border: 1px solid var(--primary-color);
        }

        #maintenance-container h1 {
            color: var(--warning-color);
            font-size: 2.2em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px var(--warning-color);
        }

        .maintenance-icon {
            width: 80px;
            height: 80px;
            fill: var(--primary-color);
            margin-bottom: 20px;
            animation: spin 4s linear infinite; /* Reutiliza a anima√ß√£o de spin, mais lenta */
        }

        /* --- Estilos do Chat em Tempo Real --- */
        #chat-toggle-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            border: none;
            cursor: pointer;
            display: none; /* Come√ßa escondido */
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 998;
            transition: transform 0.3s ease;
        }
        #chat-toggle-button:hover {
            transform: scale(1.1);
        }
        #chat-toggle-button svg {
            width: 30px;
            height: 30px;
            fill: white;
        }

        #chat-container {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 350px;
            max-width: 90vw;
            height: 450px;
            background-color: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            z-index: 999;
            transform: scale(0.95) translateY(10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        #chat-container.open {
            transform: scale(1) translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .chat-header {
            padding: 15px;
            background-color: var(--light-bg);
            border-bottom: 1px solid var(--border-color);
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-header h3 { margin: 0; font-size: 16px; color: var(--primary-color); }
        #chat-close-button { background: none; border: none; font-size: 24px; color: var(--text-color); cursor: pointer; }

        #chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse; /* Mensagens novas aparecem em baixo */
        }
        .message-item {
            margin-bottom: 10px;
            max-width: 85%;
            display: flex;
            flex-direction: column;
        }
        .message-item .sender-name { font-size: 12px; font-weight: 600; color: var(--primary-color); margin-bottom: 3px; }
        .message-item .message-text { background-color: var(--light-bg); padding: 8px 12px; border-radius: 10px; font-size: 14px; word-wrap: break-word; }
        .message-item.own-message { align-self: flex-end; text-align: right; }
        .message-item.own-message .message-text { background-color: var(--primary-color); color: white; }
        .message-item.own-message .sender-name { color: var(--text-color); }

        .chat-input-area {
            display: flex;
            padding: 10px;
            border-top: 1px solid var(--border-color);
        }
        #chat-message-input {
            flex-grow: 1;
            border: 1px solid var(--border-color);
            background-color: var(--dark-bg);
            color: var(--text-color);
            padding: 10px;
            border-radius: 20px;
            outline: none;
            margin-right: 10px;
        }
        #chat-send-button {
            background-color: var(--primary-color);
            color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer;
        }

        /* --- Decora√ß√£o de Natal e Ano Novo --- */
        .christmas-lights-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 10px;
            display: flex;
            justify-content: center;
            gap: 15px;
            z-index: 9999;
            pointer-events: none;
        }
        .christmas-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: flash 1s infinite alternate;
        }
        .christmas-light:nth-child(odd) { background: #ff3333; box-shadow: 0 0 10px #ff3333; animation-delay: 0s; }
        .christmas-light:nth-child(even) { background: #33ff33; box-shadow: 0 0 10px #33ff33; animation-delay: 0.5s; }
        .christmas-light:nth-child(3n) { background: #ffd700; box-shadow: 0 0 10px #ffd700; animation-delay: 0.2s; }
        
        @keyframes flash { from { opacity: 0.4; transform: scale(0.8); } to { opacity: 1; transform: scale(1.2); } }
        
        .snowflake {
            position: fixed;
            top: -30px;
            color: #fff;
            font-size: 20px;
            z-index: 9998;
            pointer-events: none;
            animation: fall linear infinite;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

        /* --- Estilos do Bot√£o de Natal (Veo 5.1) --- */
        .btn-christmas {
            background: linear-gradient(45deg, #d40000, #228b22, #d40000);
            background-size: 200% 200%;
            animation: christmasGradient 3s ease infinite;
            border: 2px solid #ffd700;
            box-shadow: 0 0 15px #d40000;
            color: #fff;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .btn-christmas:hover {
            box-shadow: 0 0 25px #228b22;
            transform: scale(1.05);
        }
        @keyframes christmasGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #veo-announcement {
            display: none;
            background: rgba(20, 20, 40, 0.8);
            border: 2px solid #ffd700;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 10px;
            text-align: center;
            animation: pulse-gold 2s infinite;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
        }
        #veo-announcement h3 {
            margin: 0;
            color: #ffd700;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        #veo-countdown-container {
            display: none;
            background: rgba(20, 20, 40, 0.8);
            border: 2px solid var(--primary-color);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: center;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        #veo-timer {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-light);
            font-family: monospace;
            text-shadow: 0 0 5px var(--primary-color);
        }

        /* --- Novo Banner de Funcionalidade --- */
        #new-feature-banner {
            background: linear-gradient(90deg, #ff0080, #7928ca);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: pulse-banner 2s infinite;
            cursor: pointer;
            width: 100%;
            max-width: 500px;
        }
        @keyframes pulse-banner {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* --- Configura√ß√µes e Switches --- */
        #settings-container {
            border: 5px solid var(--primary-color); /* Borda Grande */
        }

        /* Barra de Rolagem Grande */
        #settings-container::-webkit-scrollbar {
            width: 20px;
        }
        #settings-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        #settings-container::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 10px;
            border: 4px solid transparent;
            background-clip: content-box;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            width: 100%;
            box-sizing: border-box;
            color: var(--text-color);
        }
        .settings-item:last-child { border-bottom: none; }
        
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* --- Download Progress --- */
        #download-progress-bar {
            width: 100%;
            background-color: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 20px;
            margin-top: 15px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        #download-progress-fill {
            height: 100%;
            width: 0%;
            background-color: var(--success-color);
            transition: width 0.1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
        }

        /* --- Modificadores de Fun√ß√µes --- */
        body.compact-mode .btn { padding: 12px 24px; font-size: 16px; margin: 5px 0; border-radius: 10px; }
        body.compact-mode .main-title { font-size: 2em; margin-bottom: 20px; }
        body.no-animation * { animation: none !important; transition: none !important; }

    </style>
</head>
<body>

    <div id="maintenance-container" style="display: none;">
        <svg class="maintenance-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M19.48,12.52a7.49,7.49,0,0,0-1.22-3.26L19.7,7.82,18.28,6.4l-1.44,1.44a7.5,7.5,0,0,0-3.26-1.22V4.5h-2V6.62a7.5,7.5,0,0,0-3.26,1.22L6.88,6.4,5.47,7.82l1.44,1.44a7.49,7.49,0,0,0-1.22,3.26H3.5v2H5.69a7.49,7.49,0,0,0,1.22,3.26L5.47,19.2l1.41,1.41,1.44-1.44a7.5,7.5,0,0,0,3.26,1.22V22.5h2V20.38a7.5,7.5,0,0,0,3.26-1.22l1.44,1.44,1.41-1.41-1.44-1.44a7.49,7.49,0,0,0,1.22-3.26H22.5v-2ZM12,17.5A5.5,5.5,0,1,1,17.5,12,5.5,5.5,0,0,1,12,17.5Z"/>
            <path d="M12,8.5a3.5,3.5,0,1,0,3.5,3.5A3.5,3.5,0,0,0,12,8.5Z"/>
        </svg>
        <h1>Site em Manuten√ß√£o</h1>
        <p>Estamos trabalhando para melhorar sua experi√™ncia. Voltamos em breve!</p>
    </div>


    <h1 class="main-title">Participa√ß√£o Especial de Natal e Ano Novo</h1>

    <div id="new-feature-banner" style="display: none;">
        ‚ú® NOVIDADE: Crie grupos e converse com seu parceiro agora! üí¨
    </div>

    <div class="content-wrapper">
        <div id="name-container" class="entry-animation">
            <h2>Bem-vindo(a)! Qual √© o seu nome?</h2>
            <div style="display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%;">
                <input type="text" id="nameInput" placeholder="Digite seu nome aqui">
                <button id="confirmNameButton" class="btn btn-primary">Confirmar</button>
                <p style="margin: 0; font-size: 14px;">ou</p>
                <!-- Bot√£o de Login com Google -->
                <div id="g_id_onload"
                     data-client_id="COLE_SEU_ID_DO_CLIENTE_AQUI.apps.googleusercontent.com"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left">
                </div>
                <!-- Fim do Bot√£o de Login com Google -->
                <!-- Bot√£o de Login com Facebook -->
                <button id="facebookLoginButton" class="btn btn-primary" style="background-color: #1877F2; width: 240px; padding: 10px 20px; font-size: 16px; text-transform: none;">
                    Continuar com o Facebook
                </button>
            </div>
        </div>

        <div id="terms-link-container" style="text-align: center; margin-top: 20px; display: none;">
            <p style="font-size: 14px;">
                Ao continuar, voc√™ concorda com nossos 
                <a href="#" id="show-terms-link" style="color: var(--secondary-color); text-decoration: none;">Termos de Uso e Regras</a>.
            </p>
        </div>


        <div id="main-content">
            <div id="user-header">
                <img src="https://i.imgur.com/V4RclNb.png" id="profile-pic" class="profile-pic" alt="Foto de Perfil">
                <div>
                    <h2 id="welcomeMessage" style="margin-bottom: 0;"></h2>
                    <p id="userIdDisplay" style="font-size: 12px; color: var(--text-color); margin-top: 5px;"></p>
                </div>
            </div>
            <!-- Controles de Tema -->
            <div id="theme-controls" style="position: absolute; top: 50%; right: -100px; transform: translateY(-50%); display: flex; align-items: center; gap: 10px;">
                <button id="theme-toggle-button" title="Mudar tema claro/escuro">
                    <!-- √çcone de Sol (Tema Claro) -->
                    <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,7a5,5,0,1,0,5,5A5,5,0,0,0,12,7Zm0,8a3,3,0,1,1,3-3A3,3,0,0,1,12,15ZM12,2a1,1,0,0,0-1,1V5a1,1,0,0,0,2,0V3A1,1,0,0,0,12,2Zm0,18a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V21A1,1,0,0,0,12,20ZM20.66,4.76a1,1,0,0,0-1.41,0l-1.42,1.41a1,1,0,0,0,1.42,1.42l1.41-1.41A1,1,0,0,0,20.66,4.76ZM6.16,19.24a1,1,0,0,0-1.41,0L3.34,17.83a1,1,0,1,0-1.42,1.42l1.41,1.41a1,1,0,0,0,1.42,0A1,1,0,0,0,6.16,19.24ZM22,12a1,1,0,0,0-1-1H19a1,1,0,0,0,0,2h2A1,1,0,0,0,22,12ZM5,13a1,1,0,0,0,0-2H3a1,1,0,0,0,0,2ZM17.83,3.34a1,1,0,0,0,0-1.42L16.41,3.34a1,1,0,0,0-1.41,1.41l1.41,1.42a1,1,0,0,0,1.41,0A1,1,0,0,0,17.83,3.34ZM4.76,20.66a1,1,0,0,0,0-1.42L3.34,17.83a1,1,0,1,0-1.42,1.41l1.41,1.42a1,1,0,0,0,1.42,0A1,1,0,0,0,4.76,20.66Z"/></svg>
                    <!-- √çcone de Lua (Tema Escuro) -->
                    <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display: none;"><path d="M12,2A10,10,0,0,0,8.63,21.31,1,1,0,0,0,10,20.73,8,8,0,0,1,12,4a8,8,0,0,1,8,8,8,8,0,0,1-8.73,8,1,1,0,0,0-.57.91,1,1,0,0,0,1.24.8A10,10,0,0,0,12,2Z"/></svg>
                </button>
                <input type="color" id="color-picker" title="Escolher cor principal">
            </div>

            <div id="veo-countdown-container">
                <h3 style="color: var(--warning-color); margin: 0 0 10px 0; font-size: 18px; text-transform: uppercase;">Espere o Veo 5.1</h3>
                <div id="veo-timer">--d --h --m --s</div>
            </div>

            <div id="veo-announcement">
                <h3>Veo 5.1 dispon√≠vel agora!</h3>
            </div>

            <div class="button-group">
                <button id="veoButton" class="btn btn-christmas" style="display: none;">Participar no Natal</button>
                <button id="actionButton" class="btn btn-primary">Participar</button>
                <button id="partnerButton" class="btn btn-orange">Escolher um Parceiro</button>
                <button id="partnerChatButton" class="btn btn-success" style="background-color: #28a745; display: none;">Chat com Parceiro</button>
                <button id="joinGroupButton" class="btn btn-info">Entrar em um Grupo</button>
                <button id="settingsButton" class="btn btn-primary" style="background-color: #607d8b;">Configura√ß√µes ‚öôÔ∏è</button>
                <button id="myDownloadsButton" class="btn btn-info">Seus Downloads üìÇ</button>
                <button id="showPartnerButton" class="btn btn-info">Qual Parceiro eu escolhi?</button>
                <button id="declineButton" class="btn btn-purple">N√£o quero participar</button>
                <button id="maintenanceButton" class="btn btn-warning" style="display: none;">Manuten√ß√£o</button>
                <button id="viewVisitorsButton" class="btn btn-info" style="display: none;">Ver Visitantes</button>
                <button id="logoutButton" class="btn btn-warning">Sair da Conta</button>
            </div>
            <input type="file" id="profilePicInput" accept="image/*" style="display: none;">
        </div>

        <div id="partner-form-container">
            <h2>Dados do Parceiro</h2>
            <p style="color: var(--warning-color); font-size: 14px; margin-bottom: 10px; text-align: center;">√â obrigatoriamente voc√™ colocar o Instagram</p>
            <input type="text" id="partnerNameInput" class="option-btn" placeholder="Nome do parceiro">
            <input type="text" id="partnerIdInput" class="option-btn" placeholder="ID do parceiro (Obrigat√≥rio)">
            <input type="number" id="partnerAgeInput" class="option-btn" placeholder="Idade do parceiro" min="1" inputmode="numeric">
            <input type="text" id="partnerInstagramInput" class="option-btn" placeholder="Instagram do parceiro (sem @)">
            <div class="button-group-horizontal">
                <button id="partnerConfirmButton" class="btn-green">Concluir</button>
                <button id="backFromPartnerButton" class="btn btn-primary">Voltar</button>
            </div>
        </div>

        <div id="join-group-container" style="display: none; flex-direction: column; align-items: center; gap: 15px; background-color: var(--light-bg); padding: 20px; border-radius: 15px; backdrop-filter: blur(5px);">
            <h2>Entrar em um Grupo</h2>
            <input type="text" id="groupIdInput" class="option-btn" placeholder="Cole o ID do Grupo aqui">
            <div class="button-group-horizontal">
                <button id="confirmJoinGroupButton" class="btn-green">Entrar</button>
                <button id="backFromJoinGroupButton" class="btn btn-primary">Voltar</button>
            </div>
        </div>

        <div id="block-list-container">
            <h2>Bloquear Pessoas</h2>
            <!-- O campo de nome para banimento foi removido conforme solicita√ß√£o anterior. -->
            <!-- <input type="text" id="blockNameInput" class="option-btn" placeholder="Nome do usu√°rio a banir (opcional)"> -->
            <input type="text" id="blockIdInput" class="option-btn" placeholder="ID do usu√°rio a banir">
            <input type="text" id="blockReasonInput" class="option-btn" placeholder="Motivo do banimento (opcional)">
            <button id="addBlockButton" class="btn btn-red">Bloquear</button>
            <ul id="blocked-users-list"></ul>
            <button id="backFromBlockButton" class="btn btn-primary">Voltar</button>
        </div>

        <div id="visitors-container" style="display: none; flex-direction: column; align-items: center; gap: 15px; background-color: var(--light-bg); padding: 20px; border-radius: 15px; backdrop-filter: blur(5px); width: 90%; max-width: 500px;">
            <h2>Visitantes Recentes</h2>
            <p style="font-size: 12px; color: var(--text-color); margin: -10px 0 10px 0;">Mostrando os √∫ltimos 50 acessos.</p>
            <ul id="visitors-list" style="list-style: none; padding: 0; width: 100%; max-height: 300px; overflow-y: auto; text-align: left;">
                <!-- Visitantes ser√£o listados aqui -->
            </ul>
            <button id="backFromVisitorsButton" class="btn btn-primary">Voltar</button>
        </div>

        <div id="downloads-container" style="display: none; flex-direction: column; align-items: center; gap: 15px; background-color: var(--light-bg); padding: 20px; border-radius: 15px; backdrop-filter: blur(5px); width: 90%; max-width: 500px;">
            <h2>Seus Downloads</h2>
            <ul id="downloads-list" style="list-style: none; padding: 0; width: 100%; max-height: 300px; overflow-y: auto; text-align: left;"></ul>
            <button id="backFromDownloadsButton" class="btn btn-primary">Voltar</button>
        </div>

        <div id="settings-container" style="display: none; flex-direction: column; align-items: center; background-color: var(--light-bg); padding: 20px; border-radius: 15px; backdrop-filter: blur(5px); width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto;">
            <h2 style="margin-bottom: 20px;">Configura√ß√µes</h2>
            
            <div class="settings-item"><span>1. Tema Escuro</span><label class="switch"><input type="checkbox" id="toggle-theme" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>2. Decora√ß√£o de Natal</span><label class="switch"><input type="checkbox" id="toggle-christmas" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>3. Chat Global</span><label class="switch"><input type="checkbox" id="toggle-global-chat" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>4. Banner de Novidades</span><label class="switch"><input type="checkbox" id="toggle-news-banner" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>5. Mostrar meu ID</span><label class="switch"><input type="checkbox" id="toggle-show-id" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>6. Anima√ß√µes do Site</span><label class="switch"><input type="checkbox" id="toggle-animations" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>7. Efeitos de Bot√£o</span><label class="switch"><input type="checkbox" id="toggle-click-effects" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>8. Contagem Veo 5.1</span><label class="switch"><input type="checkbox" id="toggle-veo-countdown" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>9. Notifica√ß√µes</span><label class="switch"><input type="checkbox" id="toggle-notifications" checked><span class="slider"></span></label></div>
            <div class="settings-item"><span>10. Modo Compacto</span><label class="switch"><input type="checkbox" id="toggle-compact-mode"><span class="slider"></span></label></div>

            <button id="backFromSettingsButton" class="btn btn-primary" style="margin-top: 20px;">Voltar</button>
        </div>

        <!-- Modal de Progresso de Download -->
        <div id="download-progress-modal" class="notification-overlay">
            <div class="notification-box" style="width: 300px;">
                <h3 style="color: var(--secondary-color);">Baixando...</h3>
                <div id="download-icon-anim" style="font-size: 40px; margin: 10px 0;">üìÇ</div>
                <p id="download-status-text">Preparando arquivo...</p>
                <div id="download-progress-bar">
                    <div id="download-progress-fill">0%</div>
                </div>
            </div>
        </div>

        <div id="declineOptions" style="display: none;">
            <h2 style="margin-bottom: 10px;">Mandar mensagem para o suporte</h2>
            <div id="optionBugs" class="option-btn">1. Bugs</div>
            <div id="optionError" class="option-btn">2. Muito erro</div>
            <div id="optionFeatures" class="option-btn">3. Precisa de mais fun√ß√µes</div>
            <div id="optionOthers" class="option-btn">4. Outros</div>
            <div id="optionWrite" class="option-btn">5. Escrever para o suporte</div>
            <button id="backFromDeclineButton" class="btn btn-primary" style="margin-top: 15px;">Voltar</button>
        </div>

        <div id="support-message-container" style="display: none; flex-direction: column; align-items: center; gap: 15px; background-color: var(--light-bg); padding: 20px; border-radius: 15px; backdrop-filter: blur(5px);">
            <h2 style="margin-bottom: 5px;">Escreva sua mensagem</h2>
            <textarea id="supportMessageText" class="option-btn" placeholder="Sua mensagem aqui..." rows="5"></textarea>
            <div class="button-group-horizontal">
                <button id="sendSupportMessageButton" class="btn-green">Enviar</button>
                <button id="backFromSupportMessageButton" class="btn btn-primary">Voltar</button>
            </div>
        </div>

        <div id="loader">
            <div class="spinner"></div>
            <p id="loader-text">Analisando seus dados...</p>
        </div>

        <div id="feedbackMessage" style="display: none;">
            Obrigado pelo Feedback!
        </div>
    </div>

    <div id="notification" style="display: none;">
        Voc√™ j√° est√° participando!
    </div>

    <div id="animated-notification" class="notification-overlay">
        <div class="notification-box">
            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg>
            <svg class="exclamation-mark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="exclamation-circle" cx="26" cy="26" r="25" fill="none"/>
                <line class="exclamation-line" x1="26" y1="15" x2="26" y2="32" stroke-linecap="round"/>
                <line class="exclamation-dot" x1="26" y1="37" x2="26.01" y2="37" stroke-linecap="round"/>
            </svg>
            <h3 id="notification-title">Sucesso!</h3>
            <p id="notification-message">Sua a√ß√£o foi conclu√≠da.</p>
        </div>
    </div>

    <!-- Modal de Visualiza√ß√£o de Foto de Perfil -->
    <div id="profile-view-modal" class="notification-overlay">
        <div class="notification-box">
            <h3 style="margin-bottom: 15px;">Sua Foto de Perfil</h3>
            <img id="profile-view-image" src="" alt="Foto Grande" style="max-width: 100%; max-height: 50vh; border-radius: 10px; border: 3px solid var(--primary-color); margin-bottom: 20px;">
            <div class="button-group-horizontal">
                <button id="change-profile-pic-btn" class="btn btn-primary">Alterar Foto</button>
                <button id="close-profile-view-btn" class="btn btn-red">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Chat com Parceiro/Grupo -->
    <div id="partner-chat-modal" class="notification-overlay">
        <div class="notification-box" style="width: 90%; max-width: 400px; height: 80vh; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
            <div class="chat-header" style="padding: 15px; background: var(--primary-color); color: white;">
                <h3 id="partner-chat-title" style="margin: 0; font-size: 18px; color: white;">Chat</h3>
                <button id="close-partner-chat-btn" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <div style="background: var(--dark-bg); padding: 10px; text-align: center; font-size: 12px; color: var(--text-color); border-bottom: 1px solid var(--border-color);">
                ID do Grupo: <code id="group-id-display" style="user-select: all; cursor: pointer; background: rgba(255,255,255,0.1); padding: 2px 5px; border-radius: 4px;"></code> (Clique para copiar)
            </div>
            <div id="partner-chat-messages" style="flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; background: var(--light-bg); text-align: left;"></div>
            <div class="chat-input-area" style="background: var(--light-bg);">
                <input type="text" id="partner-chat-input" placeholder="Digite sua mensagem..." style="flex-grow: 1; padding: 10px; border-radius: 20px; border: 1px solid var(--border-color); background: var(--dark-bg); color: var(--text-color);">
                <button id="partner-chat-send-btn" style="background: var(--primary-color); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; margin-left: 10px; cursor: pointer;">‚û§</button>
            </div>
        </div>
    </div>

    <!-- Di√°logo de Termos de Uso -->
    <div id="terms-dialog" class="notification-overlay">
        <div class="notification-box" style="text-align: left; max-width: 500px;">
            <h3 style="text-align: center; color: var(--warning-color);">Termos de Uso e Regras</h3>
            <p>Para equilibrar este site e garantir que tudo funcione corretamente, as seguintes regras devem ser seguidas:</p>
            <ul style="padding-left: 20px; line-height: 1.6; margin-top: 15px;">
                <li><strong>1. Conte√∫do Adulto:</strong> Proibido pornografia ou qualquer conte√∫do sexual.</li>
                <li><strong>2. Fotos de Perfil:</strong> Proibido fotos de perfil que contenham conte√∫dos sexuais.</li>
                <li><strong>3. Ferramentas Externas:</strong> Proibido uso de hacks ou softwares de terceiros n√£o autorizados.</li>
                <li><strong>4. Linguagem:</strong> Proibido uso de palavr√µes. Mantenha o respeito.</li>
            </ul>
            <p style="margin-top: 20px; font-size: 14px; text-align: center;">O descumprimento pode resultar em banimento.</p>
            <div class="button-group-horizontal" style="margin-top: 20px; justify-content: center;">
                <button id="terms-agree-button" class="btn btn-primary">Eu Entendi e Concordo</button>
            </div>
        </div>
    </div>

    <!-- Di√°logo de Confirma√ß√£o -->
    <div id="confirmation-dialog" class="notification-overlay">
        <div class="notification-box">
            <h3 id="confirmation-title" style="color: var(--warning-color);">Confirmar A√ß√£o</h3>
            <p id="confirmation-message">Tem certeza?</p>
            <div class="button-group-horizontal" style="margin-top: 20px; gap: 20px;">
                <button id="confirm-yes-button" class="btn btn-red">Sim</button>
                <button id="confirm-no-button" class="btn btn-primary">N√£o</button>
            </div>
        </div>
    </div>

    <!-- Di√°logo de Informa√ß√£o do Parceiro -->
    <div id="partner-info-dialog" class="notification-overlay">
        <div class="notification-box">
            <h3 id="partner-info-title" style="color: var(--warning-color);">Seu Parceiro Escolhido</h3>
            <div id="partner-info-details" style="margin-bottom: 20px;">
                <!-- Os detalhes do parceiro ser√£o inseridos aqui pelo JavaScript -->
            </div>
            <div class="button-group-horizontal">
                <button id="partner-download-button" class="btn btn-success" style="background-color: #28a745;">Download ‚¨áÔ∏è</button>
                <button id="partner-info-back-button" class="btn btn-primary">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Chat em Tempo Real -->
    <button id="chat-toggle-button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,2H4A2,2,0,0,0,2,4V22l4-4H20a2,2,0,0,0,2-2V4A2,2,0,0,0,20,2ZM12,14H10V12h2Zm3-4H9V8h6Z"/></svg>
    </button>
    <div id="chat-container">
        <div class="chat-header">
            <h3>Chat Global</h3>
            <button id="chat-close-button">&times;</button>
        </div>
        <div id="chat-messages">
            <!-- As mensagens aparecer√£o aqui -->
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-message-input" placeholder="Digite sua mensagem..." maxlength="200">
            <button id="chat-send-button">‚û§</button>
        </div>
    </div>

    <footer>
        <p>
            Criado por @lucaspedro! | 
            <a href="https://discord.gg/qcyvmBT8" target="_blank" class="footer-link" style="color: var(--secondary-color); text-decoration: none; margin-left: 10px;">
            <a href="https://discord.gg/qcyvmBT8" target="_blank" class="footer-link" style="margin-left: 10px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019c.308-.42.582-.863.818-1.329a.05.05 0 0 0-.01-.059.051.051 0 0 0-.048-.027c-.508-.152-1.017-.39-1.508-.635a.05.05 0 0 1-.007-.08c.133-.09.273-.185.42-.287a.05.05 0 0 1 .074.007c.34.317.67.616.99.9.05.049.11.049.16.002.498-.304 1.002-.615 1.508-.935a.05.05 0 0 0 .005-.06c-.132-.1-.27-.19-.412-.287a.05.05 0 0 1-.008-.08c.472.245.98.5 1.508.635a.05.05 0 0 0-.048.027.05.05 0 0 0-.01.059c.232.466.506.909.818 1.329a.05.05 0 0 0 .056.019 13.235 13.235 0 0 0 4.001-2.02.049.049 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034 0 0 0-.02-.019Zm-8.198 7.307c-.789 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612Zm5.316 0c-.788 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612Z"/></svg>
                <span>Discord</span>
            </a> | 
            <a href="#" id="footer-terms-link" class="footer-link" style="color: var(--secondary-color); text-decoration: none; margin-left: 10px;">Termos de Uso</a>
            <a href="#" id="footer-terms-link" class="footer-link" style="margin-left: 10px;">Termos de Uso</a>
        </p>
        <p style="margin-top: 8px; font-size: 11px; color: var(--text-color);">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-shield-lock-fill" viewBox="0 0 16 16" style="vertical-align: -2px; margin-right: 4px;"><path fill-rule="evenodd" d="M8 0c-.69 0-1.843.265-2.928.56-1.11.3-2.229.655-2.887.87a1.54 1.54 0 0 0-1.044 1.262c-.596 4.477.787 7.795 2.465 9.99a11.777 11.777 0 0 0 2.517 2.453c.386.273.744.482 1.048.625.28.132.581.19.829.19s.548-.058.829-.19c.304-.143.662-.352 1.048-.625a11.775 11.775 0 0 0 2.517-2.453c1.678-2.195 3.061-5.513 2.465-9.99a1.541 1.541 0 0 0-1.044-1.263 62.468 62.468 0 0 0-2.887-.87C9.843.265 8.69 0 8 0zm0 5a1.5 1.5 0 0 1 .5 2.915l.385 1.99a.5.5 0 0 1-.491.595h-.788a.5.5 0 0 1-.49-.595l.384-1.99A1.5 1.5 0 0 1 8 5z"/></svg>
            Sua conta √© protegida. Nem mesmo o administrador pode acessar seus dados pessoais.
        </p>
    </footer>

    <script>
        const nameContainer = document.getElementById('name-container');
        const nameInput = document.getElementById('nameInput');
        const confirmNameButton = document.getElementById('confirmNameButton');
        const mainContent = document.getElementById('main-content');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const actionButton = document.getElementById('actionButton');
        const partnerButton = document.getElementById('partnerButton');
        const logoutButton = document.getElementById('logoutButton');
        const showPartnerButton = document.getElementById('showPartnerButton'); 
        const partnerFormContainer = document.getElementById('partner-form-container');
        const partnerNameInput = document.getElementById('partnerNameInput');
        const partnerIdInput = document.getElementById('partnerIdInput');
        const partnerAgeInput = document.getElementById('partnerAgeInput');
        const partnerInstagramInput = document.getElementById('partnerInstagramInput');
        const partnerConfirmButton = document.getElementById('partnerConfirmButton');
        const backFromPartnerButton = document.getElementById('backFromPartnerButton');
        const loader = document.getElementById('loader');
        const notification = document.getElementById('notification');
        const declineButton = document.getElementById('declineButton');
        const declineOptions = document.getElementById('declineOptions');
        const optionBugs = document.getElementById('optionBugs');
        const optionError = document.getElementById('optionError');
        const optionFeatures = document.getElementById('optionFeatures');
        const optionOthers = document.getElementById('optionOthers');
        const optionWrite = document.getElementById('optionWrite');
        const backFromDeclineButton = document.getElementById('backFromDeclineButton');
        const feedbackMessage = document.getElementById('feedbackMessage');
        const animatedNotification = document.getElementById('animated-notification');
        const loaderText = document.getElementById('loader-text');
        const maintenanceButton = document.getElementById('maintenanceButton');
        const blockListContainer = document.getElementById('block-list-container'); // Corrigido o ID
        const blockIdInput = document.getElementById('blockIdInput');
        // const blockNameInput = document.getElementById('blockNameInput'); // Removido, pois o campo de nome n√£o √© mais usado para banimento
        const blockReasonInput = document.getElementById('blockReasonInput');
        const addBlockButton = document.getElementById('addBlockButton');
        const blockedUsersList = document.getElementById('blocked-users-list');
        const backFromBlockButton = document.getElementById('backFromBlockButton');
        const maintenanceContainer = document.getElementById('maintenance-container');
        const confirmationDialog = document.getElementById('confirmation-dialog');
        const confirmationMessage = document.getElementById('confirmation-message');
        const confirmYesButton = document.getElementById('confirm-yes-button');
        const confirmNoButton = document.getElementById('confirm-no-button');
        const partnerInfoDialog = document.getElementById('partner-info-dialog');
        const partnerInfoDetails = document.getElementById('partner-info-details');
        const partnerInfoBackButton = document.getElementById('partner-info-back-button');
        const partnerDownloadButton = document.getElementById('partner-download-button');
        const profilePic = document.getElementById('profile-pic');
        const profilePicInput = document.getElementById('profilePicInput');
        const supportMessageContainer = document.getElementById('support-message-container');
        const supportMessageText = document.getElementById('supportMessageText');
        const sendSupportMessageButton = document.getElementById('sendSupportMessageButton');
        const backFromSupportMessageButton = document.getElementById('backFromSupportMessageButton');
        const termsDialog = document.getElementById('terms-dialog');
        const showTermsLink = document.getElementById('show-terms-link');
        const termsAgreeButton = document.getElementById('terms-agree-button');
        const termsLinkContainer = document.getElementById('terms-link-container');
        const userIdDisplay = document.getElementById('userIdDisplay');
        const viewVisitorsButton = document.getElementById('viewVisitorsButton');
        const visitorsContainer = document.getElementById('visitors-container');
        const backFromVisitorsButton = document.getElementById('backFromVisitorsButton');
        const footerTermsLink = document.getElementById('footer-terms-link');
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const colorPicker = document.getElementById('color-picker');
        const chatToggleButton = document.getElementById('chat-toggle-button');
        const chatContainer = document.getElementById('chat-container');
        const chatCloseButton = document.getElementById('chat-close-button');
        const chatMessages = document.getElementById('chat-messages');
        const chatMessageInput = document.getElementById('chat-message-input');
        const chatSendButton = document.getElementById('chat-send-button');
        const profileViewModal = document.getElementById('profile-view-modal');
        const profileViewImage = document.getElementById('profile-view-image');
        const changeProfilePicBtn = document.getElementById('change-profile-pic-btn');
        const closeProfileViewBtn = document.getElementById('close-profile-view-btn');
        const partnerChatButton = document.getElementById('partnerChatButton');
        const partnerChatModal = document.getElementById('partner-chat-modal');
        const closePartnerChatBtn = document.getElementById('close-partner-chat-btn');
        const partnerChatMessages = document.getElementById('partner-chat-messages');
        const partnerChatInput = document.getElementById('partner-chat-input');
        const partnerChatSendBtn = document.getElementById('partner-chat-send-btn');
        const groupIdDisplay = document.getElementById('group-id-display');
        const joinGroupButton = document.getElementById('joinGroupButton');
        const joinGroupContainer = document.getElementById('join-group-container');
        const confirmJoinGroupButton = document.getElementById('confirmJoinGroupButton');
        const backFromJoinGroupButton = document.getElementById('backFromJoinGroupButton');
        const groupIdInput = document.getElementById('groupIdInput');
        const newFeatureBanner = document.getElementById('new-feature-banner');
        const myDownloadsButton = document.getElementById('myDownloadsButton');
        const downloadsContainer = document.getElementById('downloads-container');
        const downloadsList = document.getElementById('downloads-list');
        const backFromDownloadsButton = document.getElementById('backFromDownloadsButton');
        const settingsButton = document.getElementById('settingsButton');
        const settingsContainer = document.getElementById('settings-container');
        const backFromSettingsButton = document.getElementById('backFromSettingsButton');
        const downloadProgressModal = document.getElementById('download-progress-modal');
        let currentGroupId = null;
        let firebaseApp = null;


        // --- INICIALIZA√á√ÉO E L√ìGICA DO FACEBOOK SDK ---
        window.fbAsyncInit = function() {
            FB.init({
                appId      : 'COLE_SEU_ID_DO_APLICATIVO_DO_FACEBOOK_AQUI',
                cookie     : true,
                xfbml      : true,
                version    : 'v19.0' // Use uma vers√£o recente da API
            });
            FB.AppEvents.logPageView();
        };

        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/pt_BR/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        // Fun√ß√£o para lidar com o login do Google
        function handleCredentialResponse(response) {
            // Decodifica o token JWT para obter as informa√ß√µes do usu√°rio
            const responsePayload = JSON.parse(atob(response.credential.split('.')[1]));

            const userName = responsePayload.name;
            const userPic = responsePayload.picture;

            if (userName) {
                // Gera um ID √∫nico para o novo usu√°rio
                if (!localStorage.getItem('userID')) {
                    const newUserID = crypto.randomUUID();
                    localStorage.setItem('userID', newUserID);
                }

                localStorage.setItem('userName', userName);
                if (userPic) {
                    localStorage.setItem('profilePicture', userPic);
                }
                // Recarrega a p√°gina para aplicar a l√≥gica de login/manuten√ß√£o
                window.location.reload();
            } else {
                showAnimatedNotification('Erro!', 'N√£o foi poss√≠vel obter seu nome do Google.', 'warning');
            }
        }

        function resetPage() {
            // Esconde todos os elementos de intera√ß√£o
            loader.style.display = 'none';
            notification.style.display = 'none';
            declineOptions.style.display = 'none';
            blockListContainer.style.display = 'none';            
            blockListContainer.classList.remove('entry-animation');
            feedbackMessage.style.display = 'none';
            partnerFormContainer.style.display = 'none';
            visitorsContainer.style.display = 'none';
            supportMessageContainer.style.display = 'none';
            downloadsContainer.style.display = 'none';
            settingsContainer.style.display = 'none';
            // Mostra o conte√∫do principal
            mainContent.style.display = 'flex';
            mainContent.classList.add('entry-animation');
            chatToggleButton.style.display = 'flex'; // Mostra o bot√£o do chat
            newFeatureBanner.style.display = 'block'; // Mostra o banner
            
            if (localStorage.getItem('hasAddedPartner') === 'true') {
                partnerChatButton.style.display = 'block';
            }
        }

        function showAnimatedNotification(title, message, type = 'success') {
            if (localStorage.getItem('setting_notifications') === 'false') return; // Respeita a configura√ß√£o

            const notificationBox = animatedNotification.querySelector('.notification-box');
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').innerHTML = message;

            const checkmark = animatedNotification.querySelector('.checkmark');
            const exclamationMark = animatedNotification.querySelector('.exclamation-mark');

            // Remove classes antigas e adiciona a nova
            notificationBox.classList.remove('success', 'warning', 'info');
            if (type === 'warning') {
                notificationBox.classList.add('warning');
                checkmark.style.display = 'none';
                exclamationMark.style.display = 'block';
            } else if (type === 'info') {
                notificationBox.classList.add('info');
                checkmark.style.display = 'none';
                exclamationMark.style.display = 'block';
            } else {
                notificationBox.classList.add('success'); // Classe padr√£o
                checkmark.style.display = 'block';
                exclamationMark.style.display = 'none';
            }

            // Reinicia a anima√ß√£o clonando o n√≥
            const newCheckmark = checkmark.cloneNode(true);
            checkmark.parentNode.replaceChild(newCheckmark, checkmark);

            const newExclamationMark = exclamationMark.cloneNode(true);
            exclamationMark.parentNode.replaceChild(newExclamationMark, exclamationMark);

            animatedNotification.classList.add('show');
            setTimeout(() => {
                animatedNotification.classList.remove('show');
            }, 2700); // Deixa a notifica√ß√£o vis√≠vel por 2.7s
        }

        function showMainContent(name) {
            nameContainer.style.display = 'none';
            welcomeMessage.textContent = `Ol√°, ${name}!`;
            mainContent.style.display = 'flex';
            chatToggleButton.style.display = 'flex'; // Mostra o bot√£o do chat
            mainContent.classList.add('entry-animation');

            // Mostra o ID do usu√°rio
            const userID = localStorage.getItem('userID');
            if (userID) {
                userIdDisplay.textContent = `ID: ${userID}`;
            }
            // Mostra o bot√£o de visitantes apenas para o admin
            const isAdmin = name.toLowerCase() === 'lucaspedro';
            if (isAdmin) {
                maintenanceButton.style.display = 'block';
                // Adiciona o bot√£o de banir dinamicamente para o admin
                if (!document.getElementById('adminBanButton')) {
                    const banBtn = document.createElement('button');
                    banBtn.id = 'adminBanButton';
                    banBtn.className = 'btn btn-red';
                    banBtn.textContent = 'Banir Usu√°rios';
                    banBtn.addEventListener('click', showBlockList);
                    // Insere o bot√£o de banir depois do bot√£o de manuten√ß√£o
                    maintenanceButton.insertAdjacentElement('afterend', banBtn);
                }
                viewVisitorsButton.style.display = 'block';
            } else {
                maintenanceButton.style.display = 'none';
                viewVisitorsButton.style.display = 'none';
            }

            // Verifica se tem parceiro para mostrar o bot√£o de chat
            if (localStorage.getItem('hasAddedPartner') === 'true') {
                partnerChatButton.style.display = 'block';
            }
        }

        // --- L√ìGICA DE TEMA ---
        function applyTheme(theme) {
            document.body.dataset.theme = theme;
            localStorage.setItem('siteTheme', theme);
            if (theme === 'light') {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        function applyPrimaryColor(color) {
            document.documentElement.style.setProperty('--primary-color', color);
            localStorage.setItem('sitePrimaryColor', color);
            colorPicker.value = color;
        }

        themeToggleButton.addEventListener('click', () => {
            const currentTheme = document.body.dataset.theme || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
        });

        // Aplica o tema salvo ao carregar a p√°gina
        const savedTheme = localStorage.getItem('siteTheme') || 'dark'; // Padr√£o escuro
        applyTheme(savedTheme);

        // L√≥gica do Seletor de Cores
        colorPicker.addEventListener('input', (event) => {
            applyPrimaryColor(event.target.value);
        });
        const savedColor = localStorage.getItem('sitePrimaryColor') || '#6a5acd'; // Cor padr√£o
        applyPrimaryColor(savedColor);

        // --- L√ìGICA DO CHAT EM TEMPO REAL ---
        function initializeFirebase() {
            // COLE A CONFIGURA√á√ÉO DO FIREBASE AQUI
            const firebaseConfig = {
                apiKey: "AIza...",
                authDomain: "seu-projeto.firebaseapp.com",
                databaseURL: "https://seu-projeto.firebaseio.com",
                projectId: "seu-projeto",
                storageBucket: "seu-projeto.appspot.com",
                messagingSenderId: "...",
                appId: "1:..."
            };

            // Evita reinicializar o app
            if (!firebase.apps.length) {
                firebaseApp = firebase.initializeApp(firebaseConfig);
            } else {
                firebaseApp = firebase.app();
            }

            // Verifica se a configura√ß√£o foi preenchida
            if (!firebaseConfig.apiKey || firebaseConfig.apiKey.startsWith("AIza...")) {
                console.warn("Firebase n√£o configurado. O chat n√£o funcionar√°.");
                chatToggleButton.style.display = 'none'; // Esconde o bot√£o se n√£o estiver configurado
                return;
            }

            const database = firebase.database();
            const messagesRef = database.ref('messages');

            // Ouvir por novas mensagens
            messagesRef.limitToLast(50).on('child_added', (snapshot) => {
                const msg = snapshot.val();
                const currentUserID = localStorage.getItem('userID');

                const messageElement = document.createElement('div');
                messageElement.classList.add('message-item');
                if (msg.userId === currentUserID) {
                    messageElement.classList.add('own-message');
                }

                messageElement.innerHTML = `
                    <span class="sender-name">${msg.userName}</span>
                    <div class="message-text">${msg.text}</div>
                `;
                chatMessages.prepend(messageElement); // Adiciona no topo para manter a ordem invertida
            });
        }

        function sendMessage() {
            const text = chatMessageInput.value.trim();
            if (text) {
                const userName = localStorage.getItem('userName');
                const userId = localStorage.getItem('userID');
                firebase.database().ref('messages').push({
                    userName: userName,
                    userId: userId,
                    text: text,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                chatMessageInput.value = '';
            }
        }


        // L√≥gica dos Termos de Uso
        showTermsLink.addEventListener('click', (e) => {
            e.preventDefault();
            termsDialog.classList.add('show');
        });

        termsAgreeButton.addEventListener('click', () => {
            termsDialog.classList.remove('show');
            confirmNameButton.disabled = false; // Habilita o bot√£o
            showAnimatedNotification('Obrigado!', 'Agora voc√™ pode confirmar seu nome.', 'success');
        });

        footerTermsLink.addEventListener('click', (e) => {
            e.preventDefault();
            termsDialog.classList.add('show');
        });

        // Evento para abrir o modal de visualiza√ß√£o ao clicar na foto
        profilePic.addEventListener('click', () => {
            profileViewImage.src = profilePic.src;
            profileViewModal.classList.add('show');
        });

        changeProfilePicBtn.addEventListener('click', () => {
            profilePicInput.click();
            profileViewModal.classList.remove('show');
        });

        closeProfileViewBtn.addEventListener('click', () => {
            profileViewModal.classList.remove('show');
        });

        // Carrega a foto de perfil do localStorage
        function loadProfilePicture() {
            const savedPic = localStorage.getItem('profilePicture');
            if (savedPic) {
                profilePic.src = savedPic;
            }
        }

        // Adiciona o listener ao bot√£o de confirmar nome
        confirmNameButton.addEventListener('click', () => {
            const userName = nameInput.value.trim();
            if (userName) {
                // Gera um ID √∫nico para o novo usu√°rio
                if (!localStorage.getItem('userID')) {
                    const newUserID = crypto.randomUUID();
                    localStorage.setItem('userID', newUserID);
                }

                localStorage.setItem('userName', userName);
                // Recarrega a p√°gina para aplicar a l√≥gica de manuten√ß√£o corretamente
                window.location.reload();
            }
        });

        // Fun√ß√£o para registrar o acesso do visitante
        async function logVisitorAccess(userName, userID) {
            const webhookUrl = 'https://webhook.site/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx';
            if (webhookUrl.includes('xxxxxxxx')) {
                console.warn("Webhook URL n√£o configurada. O acesso do visitante n√£o ser√° registrado.");
                return;
            }
            try {
                await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: userName, id: userID, timestamp: new Date().toISOString() })
                });
            } catch (error) { console.error('Erro ao registrar visitante:', error); }
        }

        // Fun√ß√£o de inicializa√ß√£o principal para verificar banimento e manuten√ß√£o
        function initializePage() {
            // 1. VERIFICA√á√ÉO DE BANIMENTO (PRIORIDADE M√ÅXIMA)
            const currentUserID = localStorage.getItem('userID');
            if (currentUserID) {
                const bannedUsers = getBlockedUsers();
                const banInfo = bannedUsers.find(user => user.id === currentUserID);
                if (banInfo) {
                    const bannedUserName = banInfo.name || 'Este usu√°rio';
                    document.body.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-color); font-family: 'Poppins', sans-serif;">
                            <h1 style="color: var(--danger-color);">Voc√™ foi banido</h1>
                            <p>${bannedUserName} n√£o pode mais acessar este site.</p>
                            <p style="font-size: 14px; color: var(--warning-color);">Motivo: ${banInfo.reason || 'N√£o especificado'}</p>
                        </div>`;
                    return; // Para a execu√ß√£o do script
                }
            }

            // 2. L√ìGICA DE LOGIN NORMAL
            const savedName = localStorage.getItem('userName');
            if (savedName) {
                // 3. VERIFICA√á√ÉO DE MODO DE MANUTEN√á√ÉO (AP√ìS O LOGIN)
                const maintenanceMode = localStorage.getItem('maintenanceMode') === 'on';
                const isAdmin = savedName.toLowerCase() === 'lucaspedro';

                if (maintenanceMode && !isAdmin) {
                    // Se a manuten√ß√£o estiver ativa e o usu√°rio n√£o for admin, mostra a tela de manuten√ß√£o.
                    document.querySelector('.content-wrapper').style.display = 'none';
                    document.querySelector('.main-title').style.display = 'none';
                    document.querySelector('footer').style.display = 'none';
                    maintenanceContainer.style.display = 'flex';
                    maintenanceContainer.classList.add('entry-animation');
                    return; // Para a execu√ß√£o
                }

                // Se passou na verifica√ß√£o (ou √© admin), continua normalmente.
                loadProfilePicture();
                const savedID = localStorage.getItem('userID');
                logVisitorAccess(savedName, savedID);
                showMainContent(savedName);
                initializeFirebase(); // Inicializa o Firebase e o chat
            } else {
                nameContainer.style.display = 'flex'; // Mostra a tela de login
                showAnimatedNotification('Aten√ß√£o!', 'Escolha seu nome apenas 1 vez.', 'info');
                termsLinkContainer.style.display = 'block'; // Mostra o link dos termos
                confirmNameButton.disabled = true; // Desabilita o bot√£o de confirmar
            }
        }

        // Executa a fun√ß√£o de inicializa√ß√£o quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', initializePage);

        // Evento para quando um arquivo for selecionado
        profilePicInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageDataUrl = e.target.result;
                    profilePic.src = imageDataUrl;
                    localStorage.setItem('profilePicture', imageDataUrl);
                    showAnimatedNotification('Sucesso!', 'Sua foto de perfil foi atualizada.', 'success');
                };
                reader.readAsDataURL(file);
            }
        });

        actionButton.addEventListener('click', () => {
            // Verifica se o usu√°rio j√° participou
            if (localStorage.getItem('hasParticipated') === 'true') {
                showAnimatedNotification('Aviso!', 'Voc√™ j√° participou e n√£o precisa acessar novamente', 'info');
                return; // Para a execu√ß√£o
            }

            // Se for a primeira vez, continua com a l√≥gica normal
            mainContent.style.display = 'none';
            loader.style.display = 'flex';

            const loadingMessages = [
                "Analisando seus dados...",
                "Verificando compatibilidade...",
                "Otimizando par√¢metros...",
                "Finalizando..."
            ];
            let messageIndex = 0;
            loaderText.textContent = loadingMessages[messageIndex];

            const messageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % loadingMessages.length;
                loaderText.style.opacity = 0;
                setTimeout(() => { loaderText.textContent = loadingMessages[messageIndex]; loaderText.style.opacity = 1; }, 500);
            }, 2500);

            setTimeout(() => {
                loader.style.display = 'none';
                clearInterval(messageInterval); // Garante que o intervalo de mensagens pare

                // Marca que o usu√°rio j√° participou
                localStorage.setItem('hasParticipated', 'true');

                showAnimatedNotification('Sucesso!', 'Voc√™ j√° est√° participando!');
                setTimeout(() => {
                    resetPage();
                }, 3000); // Volta ao in√≠cio ap√≥s 3 segundos
            }, 10000); // 10 segundos para o loader
        });

        declineButton.addEventListener('click', () => {
            mainContent.style.display = 'none';
            mainContent.classList.remove('entry-animation');
            declineOptions.style.display = 'flex';
            declineOptions.classList.add('entry-animation');
        });

        function showPartnerForm() {
            mainContent.style.display = 'none';
            mainContent.classList.remove('entry-animation');
            partnerFormContainer.style.display = 'flex';
            partnerFormContainer.classList.add('entry-animation');
        }

        partnerButton.addEventListener('click', () => {
            if (localStorage.getItem('hasAddedPartner') === 'true') {
                document.getElementById('confirmation-title').textContent = 'Trocar de Parceiro?';
                confirmationMessage.textContent = 'Voc√™ j√° tem um parceiro. Deseja troc√°-lo por um novo?';
                confirmationDialog.classList.add('show');

                confirmYesButton.onclick = () => {
                    confirmationDialog.classList.remove('show');
                    showPartnerForm();
                };
                confirmNoButton.onclick = () => confirmationDialog.classList.remove('show');
            } else {
                showPartnerForm();
            }
        });

        showPartnerButton.addEventListener('click', () => {
            const partnerDataString = localStorage.getItem('partnerData');
            if (partnerDataString) {
                const partnerData = JSON.parse(partnerDataString);
                const message = `
                    <p style="text-align: left; line-height: 1.6;">
                        <strong>Nome:</strong> ${partnerData.name}<br>
                        <strong>ID:</strong> ${partnerData.id || 'N√£o informado'}<br>
                        <strong>Idade:</strong> ${partnerData.age}<br>
                        <strong>Instagram:</strong> @${partnerData.instagram}
                    </p>`;
                partnerInfoDetails.innerHTML = message;
                partnerInfoDialog.classList.add('show');
            } else {
                showAnimatedNotification('Aviso!', 'Voc√™ ainda n√£o escolheu um parceiro.', 'info');
            }
        });

        partnerInfoBackButton.addEventListener('click', () => {
            partnerInfoDialog.classList.remove('show');
        });

        function getSavedDownloads() {
            const downloads = localStorage.getItem('savedDownloads');
            return downloads ? JSON.parse(downloads) : [];
        }

        partnerDownloadButton.addEventListener('click', () => {
            // Anima√ß√£o de Download
            downloadProgressModal.classList.add('show');
            const progressBarFill = document.getElementById('download-progress-fill');
            const statusText = document.getElementById('download-status-text');
            const iconAnim = document.getElementById('download-icon-anim');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressBarFill.style.width = progress + '%';
                progressBarFill.textContent = Math.floor(progress) + '%';
                
                if (progress < 30) statusText.textContent = "Compactando dados...";
                else if (progress < 70) statusText.textContent = "Gerando arquivo...";
                else statusText.textContent = "Finalizando...";

                iconAnim.style.transform = `scale(${1 + Math.sin(progress) * 0.1})`;

                if (progress === 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        performDownload();
                        downloadProgressModal.classList.remove('show');
                    }, 500);
                }
            }, 200);
        });

        function performDownload() {
            const partnerDataString = localStorage.getItem('partnerData');
            if (partnerDataString) {
                const partnerData = JSON.parse(partnerDataString);
                
                const savedDownloads = getSavedDownloads();
                if (!savedDownloads.some(d => d.id === partnerData.id)) {
                    partnerData.savedAt = new Date().toISOString();
                    savedDownloads.push(partnerData);
                    localStorage.setItem('savedDownloads', JSON.stringify(savedDownloads));
                }

                const textContent = `=== DADOS DO PARCEIRO ===\n\nNome: ${partnerData.name}\nID: ${partnerData.id}\nIdade: ${partnerData.age}\nInstagram: @${partnerData.instagram}\n\nSalvo em: ${new Date().toLocaleString()}\n\nEste arquivo garante que voc√™ tenha os dados salvos offline.`;
                
                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Parceiro_${partnerData.name.replace(/\s+/g, '_')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showAnimatedNotification('Salvo!', 'Salvo em "Seus Downloads" e arquivo baixado.', 'success');
            }
        }

        function renderDownloads() {
            const downloads = getSavedDownloads();
            downloadsList.innerHTML = '';
            if (downloads.length === 0) {
                downloadsList.innerHTML = '<li style="text-align:center; padding: 10px;">Nenhum download salvo.</li>';
                return;
            }
            downloads.forEach((item, index) => {
                const li = document.createElement('li');
                li.style.cssText = 'background-color: var(--light-bg); padding: 10px; margin-bottom: 5px; border-radius: 5px; border: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;';
                
                const infoDiv = document.createElement('div');
                infoDiv.innerHTML = `<strong>${item.name}</strong><br><small style="font-size: 10px;">${new Date(item.savedAt).toLocaleDateString()}</small>`;
                
                const actionsDiv = document.createElement('div');
                
                const viewBtn = document.createElement('button');
                viewBtn.textContent = 'Ver';
                viewBtn.style.cssText = 'background: var(--secondary-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px; font-size: 12px;';
                viewBtn.onclick = () => {
                     alert(`Nome: ${item.name}\nID: ${item.id}\nIdade: ${item.age}\nInstagram: @${item.instagram}`);
                };

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'üóëÔ∏è';
                deleteBtn.style.cssText = 'background: var(--danger-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;';
                deleteBtn.onclick = () => {
                    downloads.splice(index, 1);
                    localStorage.setItem('savedDownloads', JSON.stringify(downloads));
                    renderDownloads();
                };

                actionsDiv.appendChild(viewBtn);
                actionsDiv.appendChild(deleteBtn);
                li.appendChild(infoDiv);
                li.appendChild(actionsDiv);
                downloadsList.appendChild(li);
            });
        }

        myDownloadsButton.addEventListener('click', () => {
            mainContent.style.display = 'none';
            downloadsContainer.style.display = 'flex';
            downloadsContainer.classList.add('entry-animation');
            renderDownloads();
        });

        backFromDownloadsButton.addEventListener('click', () => {
            downloadsContainer.style.display = 'none';
            resetPage();
        });

        partnerConfirmButton.addEventListener('click', () => {
            const age = parseInt(partnerAgeInput.value, 10);
            const name = partnerNameInput.value.trim();
            const instagram = partnerInstagramInput.value.trim();
            const id = partnerIdInput.value.trim();

            if (!name || !age || !instagram || !id) {
                showAnimatedNotification('Aten√ß√£o!', 'Por favor, preencha todos os campos.', 'info');
                return;
            }

            if (age >= 30) {
                showAnimatedNotification('Erro!', 'A idade n√£o pode ser 30 anos ou mais.', 'warning');
            } else {
                const partnerData = {
                    name: name,
                    age: age,
                    instagram: instagram,
                    id: id
                };
                localStorage.setItem('partnerData', JSON.stringify(partnerData));
                localStorage.setItem('hasAddedPartner', 'true'); // Mantendo para compatibilidade
                partnerFormContainer.style.display = 'none';
                partnerFormContainer.classList.remove('entry-animation');
                partnerNameInput.value = '';
                partnerAgeInput.value = '';
                partnerIdInput.value = '';
                partnerInstagramInput.value = '';
                showAnimatedNotification('Conclu√≠do!', 'Parceiro adicionado com sucesso!');
                partnerChatButton.style.display = 'block'; // Mostra o bot√£o de chat
                setTimeout(() => {
                    resetPage();
                }, 3000);
            }
        });

        backFromPartnerButton.addEventListener('click', () => {
            partnerFormContainer.style.display = 'none';
            partnerFormContainer.classList.remove('entry-animation');
            mainContent.style.display = 'flex';
            mainContent.classList.add('entry-animation');
        });

        function handleSupportOptionClick() {
            declineOptions.style.display = 'none';
            declineOptions.classList.remove('entry-animation');
            showAnimatedNotification('Obrigado!', 'Seu feedback foi enviado.');
            setTimeout(() => {
                resetPage();
            }, 3000);
        }

        optionBugs.addEventListener('click', handleSupportOptionClick);
        optionError.addEventListener('click', handleSupportOptionClick);
        optionFeatures.addEventListener('click', handleSupportOptionClick);
        optionOthers.addEventListener('click', handleSupportOptionClick);

        optionWrite.addEventListener('click', () => {
            declineOptions.style.display = 'none';
            declineOptions.classList.remove('entry-animation');
            supportMessageContainer.style.display = 'flex';
            supportMessageContainer.classList.add('entry-animation');
        });

        sendSupportMessageButton.addEventListener('click', () => {
            const message = supportMessageText.value.trim();
            if (message) {
                // L√≥gica para enviar a mensagem (aqui apenas simulamos)
                console.log('Mensagem de suporte enviada:', message);
                supportMessageText.value = ''; // Limpa o campo
                supportMessageContainer.style.display = 'none';
                showAnimatedNotification('Obrigado!', 'Sua mensagem foi enviada com sucesso.');
                setTimeout(resetPage, 3000);
            } else {
                showAnimatedNotification('Aten√ß√£o!', 'Por favor, escreva uma mensagem antes de enviar.', 'info');
            }
        });

        backFromSupportMessageButton.addEventListener('click', () => {
            supportMessageContainer.style.display = 'none';
            declineOptions.style.display = 'flex'; // Volta para as op√ß√µes de suporte
        });


        backFromDeclineButton.addEventListener('click', () => {
            declineOptions.style.display = 'none';
            declineOptions.classList.remove('entry-animation');
            resetPage();
        });

        // Helper function to get blocked users from localStorage
        function getBlockedUsers() {
            const blockedUsersString = localStorage.getItem('blockedUsers');
            return blockedUsersString ? JSON.parse(blockedUsersString) : [];
        }

        // Helper function to save blocked users to localStorage
        function saveBlockedUsers(users) {
            localStorage.setItem('blockedUsers', JSON.stringify(users));
        }

        function renderBlockedUsers() {
            const blockedUsers = getBlockedUsers();
            blockedUsersList.innerHTML = '';
            const listTitle = document.createElement('h3');
            listTitle.textContent = 'Usu√°rios Banidos:';
            listTitle.style.marginTop = '10px';
            blockedUsersList.appendChild(listTitle);

            if (blockedUsers.length === 0) {
                listTitle.textContent = 'Nenhum usu√°rio banido.';
            }
            blockedUsers.forEach(user => {
                const li = document.createElement('li');
                const span = document.createElement('span');
                span.innerHTML = `${user.name ? `<strong>${user.name}</strong><br>` : ''}ID: <code>${user.id}</code><br><small>Motivo: ${user.reason || 'N/A'}</small>`;

                const unblockBtn = document.createElement('button');
                unblockBtn.textContent = 'Desbanir';
                unblockBtn.className = 'unblock-btn';

                unblockBtn.addEventListener('click', () => {
                    let currentBlocked = getBlockedUsers();
                    currentBlocked = currentBlocked.filter(blockedUser => blockedUser.id !== user.id);
                    saveBlockedUsers(currentBlocked);
                    renderBlockedUsers();
                    showAnimatedNotification('Sucesso!', `O usu√°rio com ID ${user.id} foi desbanido.`);
                });

                li.appendChild(span);
                li.appendChild(unblockBtn);
                blockedUsersList.appendChild(li);
            });
        }
        
        function showBlockList() {
            mainContent.style.display = 'none';
            mainContent.classList.remove('entry-animation');
            blockListContainer.style.display = 'flex';
            blockListContainer.classList.add('entry-animation');
            renderBlockedUsers(); // Renderiza a lista de usu√°rios banidos
        }

        addBlockButton.addEventListener('click', () => {
            const idToBlock = blockIdInput.value.trim();
            const reason = blockReasonInput.value.trim();
            const nameToBlock = ''; // O nome n√£o √© mais usado para banimento, apenas ID e motivo

            if (!idToBlock) {
                showAnimatedNotification('Aten√ß√£o!', 'Por favor, insira o ID do usu√°rio para banir.', 'info');
                return;
            }

            const adminID = localStorage.getItem('userID');
            if (idToBlock === adminID) {
                showAnimatedNotification('Aten√ß√£o!', 'Voc√™ n√£o pode banir a si mesmo.', 'warning');
                return;
            }
            
            let blockedUsers = getBlockedUsers();
            if (blockedUsers.some(user => user.id === idToBlock)) {
                showAnimatedNotification('Aviso!', `O usu√°rio com ID ${idToBlock} j√° est√° banido.`, 'info');
                return;
            }

            // Atualiza a mensagem de confirma√ß√£o para incluir o nome
            confirmationMessage.innerHTML = `Tem certeza que deseja banir o usu√°rio com o ID:<br><code>${idToBlock}</code>?`;
            confirmationDialog.classList.add('show');

            confirmYesButton.onclick = () => {
                const blockedPerson = { id: idToBlock, name: nameToBlock, reason: reason };
                blockedUsers.push(blockedPerson);
                saveBlockedUsers(blockedUsers);
                renderBlockedUsers();
                blockIdInput.value = '';
                blockReasonInput.value = '';
                confirmationDialog.classList.remove('show');
                showAnimatedNotification('Banido!', `O usu√°rio foi adicionado √† lista de banimento.`);
            };

            confirmNoButton.onclick = () => confirmationDialog.classList.remove('show');
        });

        backFromBlockButton.addEventListener('click', () => {
            resetPage();
        });

        // --- NOVO: L√≥gica para Visualiza√ß√£o de Visitantes (Admin) ---
        async function showVisitors() {
            // IMPORTANTE: Substitua pela URL que busca os dados (ex: de um servi√ßo como npoint.io ou seu backend)
            const dataUrl = 'https://api.npoint.io/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';
            if (dataUrl.includes('xxxxxxxx')) {
                showAnimatedNotification('Erro de Configura√ß√£o', 'A URL para buscar os dados dos visitantes n√£o foi definida.', 'warning');
                return;
            }

            mainContent.style.display = 'none';
            loader.style.display = 'flex';
            loaderText.textContent = 'Buscando dados dos visitantes...';

            try {
                const response = await fetch(dataUrl);
                const visitors = await response.json();
                const visitorsList = document.getElementById('visitors-list');
                visitorsList.innerHTML = ''; // Limpa a lista

                // Mostra os visitantes em ordem decrescente (mais recente primeiro)
                visitors.reverse().forEach(visitor => {
                    const li = document.createElement('li');
                    const visitDate = new Date(visitor.timestamp).toLocaleString('pt-BR');
                    // NOVO: Adiciona um elemento <code> clic√°vel para o ID
                    li.innerHTML = `<strong style="color: var(--primary-color);">${visitor.name}</strong> (ID: <code class="copyable-id" title="Clique para copiar">${visitor.id}</code>) - <span style="font-size: 12px;">${visitDate}</span>`;
                    li.style.cssText = 'background-color: var(--light-bg); padding: 8px; margin-bottom: 5px; border-radius: 5px; border-left: 3px solid var(--primary-color);';
                    
                    // NOVO: Adiciona o evento de clique para copiar o ID
                    li.querySelector('.copyable-id').addEventListener('click', (e) => {
                        e.stopPropagation(); // Impede que outros eventos de clique sejam acionados
                        navigator.clipboard.writeText(visitor.id);
                        showAnimatedNotification('Copiado!', `O ID ${visitor.id} foi copiado.`, 'info');
                    });

                    visitorsList.appendChild(li);
                });

                loader.style.display = 'none';
                visitorsContainer.style.display = 'flex';
            } catch (error) {
                loader.style.display = 'none';
                showAnimatedNotification('Erro!', 'N√£o foi poss√≠vel carregar a lista de visitantes.', 'warning');
                setTimeout(resetPage, 3000);
            }
        }

        viewVisitorsButton.addEventListener('click', showVisitors);

        backFromVisitorsButton.addEventListener('click', resetPage);

        maintenanceButton.addEventListener('click', () => {
            const maintenanceMode = localStorage.getItem('maintenanceMode');
            if (maintenanceMode === 'on') {
                localStorage.setItem('maintenanceMode', 'off');
                showAnimatedNotification('Manuten√ß√£o Desativada', 'O site est√° online para todos.', 'success');
            } else {
                localStorage.setItem('maintenanceMode', 'on');
                showAnimatedNotification('Manuten√ß√£o Ativada', 'Apenas voc√™ pode acessar o site.', 'warning');
            }
            setTimeout(() => {
                window.location.reload();
            }, 3000);
        });

        logoutButton.addEventListener('click', () => {
            document.getElementById('confirmation-title').textContent = 'Sair da Conta?';
            confirmationMessage.textContent = 'Tem certeza que deseja sair? Seus dados de participa√ß√£o ficar√£o salvos.';
            confirmationDialog.classList.add('show');

            confirmYesButton.onclick = () => {
                // Limpa apenas os dados de sess√£o, mantendo os dados de participa√ß√£o
                localStorage.removeItem('userName');
                localStorage.removeItem('profilePicture');
                window.location.reload();
            };
            confirmNoButton.onclick = () => confirmationDialog.classList.remove('show');
        });

        // L√≥gica do Bot√£o de Login do Facebook
        document.getElementById('facebookLoginButton').addEventListener('click', () => {
            FB.login(function(response) {
                if (response.authResponse) {
                    // Usu√°rio logado e autorizou o app
                    FB.api('/me', {fields: 'name,picture.type(large)'}, function(apiResponse) {
                        if (apiResponse && !apiResponse.error) {
                            const userName = apiResponse.name;
                            const userPic = apiResponse.picture.data.url;

                            if (!localStorage.getItem('userID')) {
                                const newUserID = crypto.randomUUID();
                                localStorage.setItem('userID', newUserID);
                            }
                            localStorage.setItem('userName', userName);
                            localStorage.setItem('profilePicture', userPic);
                            window.location.reload();
                        } else {
                            showAnimatedNotification('Erro!', 'N√£o foi poss√≠vel obter seus dados do Facebook.', 'warning');
                        }
                    });
                } else {
                    // Usu√°rio cancelou o login ou n√£o autorizou completamente
                    showAnimatedNotification('Aviso!', 'O login com Facebook foi cancelado.', 'info');
                }
            }, {scope: 'public_profile,email'});
        });

        // Eventos da UI do Chat
        chatToggleButton.addEventListener('click', () => {
            chatContainer.classList.toggle('open');
        });
        chatCloseButton.addEventListener('click', () => {
            chatContainer.classList.remove('open');
        });
        chatSendButton.addEventListener('click', sendMessage);
        chatMessageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // --- L√ìGICA DO CHAT COM PARCEIRO / GRUPO ---
        
        function openPartnerChat(groupId, title) {
            currentGroupId = groupId;
            document.getElementById('partner-chat-title').textContent = title;
            groupIdDisplay.textContent = groupId;
            partnerChatMessages.innerHTML = ''; // Limpa mensagens anteriores
            partnerChatModal.classList.add('show');

            // Carregar mensagens do Firebase para este grupo
            if (firebaseApp) {
                const groupRef = firebase.database().ref('groups/' + groupId);
                groupRef.off(); // Remove listeners anteriores
                groupRef.limitToLast(50).on('child_added', (snapshot) => {
                    const msg = snapshot.val();
                    const currentUserID = localStorage.getItem('userID');
                    const msgDiv = document.createElement('div');
                    msgDiv.style.marginBottom = '10px';
                    msgDiv.style.padding = '8px 12px';
                    msgDiv.style.borderRadius = '10px';
                    msgDiv.style.maxWidth = '80%';
                    msgDiv.style.wordWrap = 'break-word';
                    
                    if (msg.userId === currentUserID) {
                        msgDiv.style.alignSelf = 'flex-end';
                        msgDiv.style.background = 'var(--primary-color)';
                        msgDiv.style.color = 'white';
                        msgDiv.style.marginLeft = 'auto';
                    } else {
                        msgDiv.style.alignSelf = 'flex-start';
                        msgDiv.style.background = 'var(--dark-bg)';
                        msgDiv.style.color = 'var(--text-color)';
                        msgDiv.style.border = '1px solid var(--border-color)';
                    }
                    
                    msgDiv.innerHTML = `<strong style="font-size: 12px; display: block; margin-bottom: 2px;">${msg.userName}</strong>${msg.text}`;
                    partnerChatMessages.appendChild(msgDiv);
                    partnerChatMessages.scrollTop = partnerChatMessages.scrollHeight;
                });
            }
        }

        partnerChatButton.addEventListener('click', () => {
            const partnerData = JSON.parse(localStorage.getItem('partnerData'));
            const userId = localStorage.getItem('userID');
            
            if (!partnerData || !partnerData.id) {
                showAnimatedNotification('Erro', 'ID do parceiro n√£o encontrado. Atualize os dados.', 'warning');
                return;
            }

            // Gera um ID de chat √∫nico combinando os dois IDs (ordenados para ser igual para ambos)
            const ids = [userId, partnerData.id].sort();
            const groupId = 'chat_' + ids.join('_'); 
            openPartnerChat(groupId, `Chat com ${partnerData.name}`);
        });

        joinGroupButton.addEventListener('click', () => {
            mainContent.style.display = 'none';
            joinGroupContainer.style.display = 'flex';
            joinGroupContainer.classList.add('entry-animation');
        });

        backFromJoinGroupButton.addEventListener('click', () => {
            joinGroupContainer.style.display = 'none';
            resetPage();
        });

        confirmJoinGroupButton.addEventListener('click', () => {
            const groupId = groupIdInput.value.trim();
            if (groupId) {
                openPartnerChat(groupId, 'Grupo ' + groupId);
                joinGroupContainer.style.display = 'none';
                // N√£o reseta a p√°gina, fica no modal
            } else {
                showAnimatedNotification('Erro', 'Digite um ID de grupo v√°lido.', 'warning');
            }
        });

        closePartnerChatBtn.addEventListener('click', () => {
            partnerChatModal.classList.remove('show');
            if (firebaseApp && currentGroupId) {
                firebase.database().ref('groups/' + currentGroupId).off(); // Para de ouvir
            }
            currentGroupId = null;
        });

        partnerChatSendBtn.addEventListener('click', () => {
            const text = partnerChatInput.value.trim();
            if (text && currentGroupId && firebaseApp) {
                firebase.database().ref('groups/' + currentGroupId).push({
                    userId: localStorage.getItem('userID'),
                    userName: localStorage.getItem('userName'),
                    text: text,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                partnerChatInput.value = '';
            }
        });

        groupIdDisplay.addEventListener('click', () => {
            navigator.clipboard.writeText(groupIdDisplay.textContent);
            showAnimatedNotification('Copiado!', 'ID do grupo copiado para a √°rea de transfer√™ncia.');
        });

        // --- L√ìGICA DE CONFIGURA√á√ïES (10 FUN√á√ïES) ---
        const settingsToggles = {
            'toggle-theme': { key: 'setting_theme', default: true, action: (v) => applyTheme(v ? 'dark' : 'light') },
            'toggle-christmas': { key: 'setting_christmas', default: true, action: (v) => {
                const lights = document.querySelector('.christmas-lights-container');
                if (lights) lights.style.display = v ? 'flex' : 'none';
                // Para parar a neve, precisar√≠amos limpar o intervalo, mas ocultar via CSS √© mais simples para este exemplo
                const style = document.getElementById('snow-style');
                if (!style) {
                    const s = document.createElement('style');
                    s.id = 'snow-style';
                    document.head.appendChild(s);
                }
                document.getElementById('snow-style').textContent = v ? '' : '.snowflake { display: none !important; }';
            }},
            'toggle-global-chat': { key: 'setting_globalChat', default: true, action: (v) => chatToggleButton.style.display = v ? 'flex' : 'none' },
            'toggle-news-banner': { key: 'setting_newsBanner', default: true, action: (v) => newFeatureBanner.style.display = v ? 'block' : 'none' },
            'toggle-show-id': { key: 'setting_showId', default: true, action: (v) => userIdDisplay.style.visibility = v ? 'visible' : 'hidden' },
            'toggle-animations': { key: 'setting_animations', default: true, action: (v) => document.body.classList.toggle('no-animation', !v) },
            'toggle-click-effects': { key: 'setting_clickEffects', default: true, action: (v) => { /* CSS handles .btn:active based on class if needed, but default is on */ } },
            'toggle-veo-countdown': { key: 'setting_veoCountdown', default: true, action: (v) => {
                const el = document.getElementById('veo-countdown-container');
                if(el) el.style.visibility = v ? 'visible' : 'hidden';
            }},
            'toggle-notifications': { key: 'setting_notifications', default: true, action: (v) => { /* Checked in showAnimatedNotification */ } },
            'toggle-compact-mode': { key: 'setting_compactMode', default: false, action: (v) => document.body.classList.toggle('compact-mode', v) }
        };

        function initSettings() {
            for (const [id, config] of Object.entries(settingsToggles)) {
                const el = document.getElementById(id);
                const saved = localStorage.getItem(config.key);
                const isChecked = saved === null ? config.default : saved === 'true';
                
                el.checked = isChecked;
                config.action(isChecked);

                el.addEventListener('change', (e) => {
                    const val = e.target.checked;
                    localStorage.setItem(config.key, val);
                    config.action(val);
                    
                    // L√≥gica espec√≠fica para o tema que usa outra chave
                    if (id === 'toggle-theme') {
                        applyTheme(val ? 'dark' : 'light');
                    }
                });
            }
        }

        settingsButton.addEventListener('click', () => {
            mainContent.style.display = 'none';
            settingsContainer.style.display = 'flex';
            settingsContainer.classList.add('entry-animation');
        });

        backFromSettingsButton.addEventListener('click', () => {
            settingsContainer.style.display = 'none';
            resetPage();
        });

        // Inicializa as configura√ß√µes ao carregar
        initSettings();

        // --- Decora√ß√£o de Natal e Ano Novo ---
        function initChristmasDecorations() {
            // Luzes
            const lightsContainer = document.createElement('div');
            lightsContainer.className = 'christmas-lights-container';
            for(let i=0; i<40; i++) {
                const light = document.createElement('div');
                light.className = 'christmas-light';
                lightsContainer.appendChild(light);
            }
            document.body.appendChild(lightsContainer);

            // Neve
            setInterval(() => {
                const snow = document.createElement('div');
                snow.className = 'snowflake';
                snow.textContent = ['‚ùÑ', '‚ùÖ', '‚ùÜ'][Math.floor(Math.random() * 3)];
                snow.style.left = Math.random() * 100 + 'vw';
                snow.style.animationDuration = (Math.random() * 3 + 2) + 's';
                snow.style.opacity = Math.random();
                snow.style.fontSize = (Math.random() * 15 + 10) + 'px';
                document.body.appendChild(snow);
                setTimeout(() => snow.remove(), 5000);
            }, 300);
        }
        
        // Iniciar decora√ß√µes
        initChristmasDecorations();

        // --- L√≥gica do Evento de Natal (Veo 5.1) ---
        function checkVeoAvailability() {
            const now = new Date();
            const currentYear = now.getFullYear();
            // M√™s 11 = Dezembro. Dia 24, 22:00:00.
            const targetDate = new Date(currentYear, 11, 24, 22, 0, 0);
            
            const veoButton = document.getElementById('veoButton');
            const veoAnnouncement = document.getElementById('veo-announcement');
            const countdownContainer = document.getElementById('veo-countdown-container');
            const timerElement = document.getElementById('veo-timer');

            let timerInterval;

            function updateTimer() {
                const currentTime = new Date();
                const diff = targetDate - currentTime;

                if (diff <= 0) {
                    if (veoButton) veoButton.style.display = 'block';
                    if (veoAnnouncement) veoAnnouncement.style.display = 'block';
                    if (countdownContainer) countdownContainer.style.display = 'none';
                    if (timerInterval) clearInterval(timerInterval);
                    return true; // Para o intervalo
                } else {
                    if (veoButton) veoButton.style.display = 'none';
                    if (veoAnnouncement) veoAnnouncement.style.display = 'none';
                    if (countdownContainer) countdownContainer.style.display = 'block';

                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    if (timerElement) timerElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                    return false; // Continua o intervalo
                }
            }

            if (!updateTimer()) {
                
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        document.getElementById('veoButton').addEventListener('click', () => {
            showAnimatedNotification('Veo 5.1', 'Bem-vindo ao evento especial de Natal!', 'success');
        });

        checkVeoAvailability();
    </script>

</body>
</html> 
    </script>
